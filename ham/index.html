<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>General & Restricted Grade Ham Radio Exam Prep Guide (India)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font import and basic styling */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        :root {
            /* --primary: #38bdf8; Sky 400 */
            --primary: #3b82f6;
            /* Sky 400 */
            --secondary: #fcd34d;
            /* Amber 300 */
            --bg-dark: #1f2937;
            /* Gray 800 */
            --bg-light: #4b5563;
            /* Gray 600 */
        }

        body {
            font-family: 'Inter', sans-serif;
            /* Dark Theme Background and default text color */
            background-color: #1a202c;
            /* dark slate gray */
            color: #e2e8f0;
            /* light gray text */
            min-height: 100vh;
        }

        /* Custom styling for cards and shadows */
        .card {
            /* Slightly lighter dark background for cards */
            background: #2d3748;
            /* dark gray */
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }

        .card2 {
            /* Slightly lighter dark background for cards */
            background: #2d3748;
            /* dark gray */
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card2:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }

        .tab-button.active {
            background-color: #3b82f6;
            /* bright blue-500 */
            color: white;
            font-weight: 600;
        }

        .dot-dash {
            font-family: monospace;
            font-weight: bold;
            letter-spacing: 2px;
            color: #60a5fa;
            /* light blue for morse */
        }

        /* Simple table for phonetics */
        .phonetic-table {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }

        .phonetic-item {
            background-color: #374151;
            /* gray-700 */
            border-radius: 0.5rem;
            padding: 0.75rem;
            text-align: center;
        }

        .phonetic-letter {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fff;
        }

        .phonetic-word {
            font-size: 1rem;
            color: #60a5fa;
            /* light blue-400 */
        }

        /* Simple table for lists */
        .simple-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.5rem;
        }

        .simple-list-item {
            background-color: #374151;
            /* gray-700 */
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            font-family: monospace;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--bg-dark);
            font-weight: 700;
            border: 2px solid var(--primary);
            transition: all 0.15s;
        }

        .btn-primary:hover {
            background-color: #0ea5e9;
            /* Sky 500 */
            transform: translateY(-1px);
        }

        .btn-primary:active {
            transform: translateY(1px);
        }

        .keyer-button {
            height: 150px;
            background-color: var(--primary);
            border: 4px solid var(--secondary);
            animation: pulse-border 2s infinite;
        }

        .keyer-button:active {
            background-color: #0ea5e9;
            box-shadow: 0 0 40px var(--primary);
        }

        .dot {
            color: var(--secondary);
        }

        .dash {
            color: var(--primary);
        }

        @keyframes pulse-border {
            0% {
                box-shadow: 0 0 0 0 rgba(252, 211, 77, 0.7);
            }

            70% {
                box-shadow: 0 0 0 20px rgba(252, 211, 77, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(252, 211, 77, 0);
            }
        }

        @keyframes slide-up {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-slide-up {
            animation: slide-up 0.5s ease-out forwards;
        }
    </style>
</head>

<body class="p-4 md:p-8 text-gray-100">

    <div id="app" class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-50">General & Restricted Grade Ham Radio Exam Prep Guide
                (India) <span class="text-xl text-blue-400">General Grade</span></h1>
            <p class="text-gray-400 mt-2">Your interactive study guide for the ASOC Examination.</p>
        </header>

        <!-- Global Settings (WPM) -->
        <div
            class="bg-gray-800 p-4 rounded-xl shadow-lg mb-6 flex justify-center items-center space-x-4 border border-gray-700">
            <label for="global-wpm-slider" class="font-bold text-gray-300">Global Speed (WPM):</label>
            <span id="global-wpm-value" class="text-amber-300 font-bold text-xl w-8 text-center">12</span>
            <input type="range" id="global-wpm-slider" min="5" max="40" value="12"
                class="w-full max-w-xs h-3 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-500">
        </div>

        <!-- Navigation Tabs -->
        <nav class="flex overflow-x-auto justify-start bg-gray-800 p-2 rounded-xl shadow-lg mb-8 space-x-2">
            <button class="tab-button px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200"
                onclick="showSection('morsecode')">Morse Code</button>
            <button class="tab-button active px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200"
                onclick="showSection('morsepractice')">Morse Practice</button>
            <button class="tab-button px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200"
                onclick="showSection('rules')">Part A: Rules</button>
            <button class="tab-button px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200"
                onclick="showSection('electronics')">Part B: Electronics</button>
            <button class="tab-button px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200"
                onclick="showSection('quiz')">Quiz Time!</button>
            <button class="tab-button px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200"
                onclick="showSection('content-morse')">Morse Quiz</button>
            <button class="tab-button px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200"
                onclick="showSection('syllabus')">Syllabus</button>
        </nav>

        <!-- Content Sections -->

        <!-- 1. Morse Practice -->
        <section id="morsepractice" class="content-section">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

                <div class="card p-6 rounded-xl order-1">
                    <h2 class="text-3xl font-bold mb-4 border-b pb-2 border-amber-300">1. Transmission Practice (Keyer)
                    </h2>
                    <p class="text-sm text-gray-300 mb-4">Click the keyer button or hold the <span
                            class="font-bold text-amber-300">SPACEBAR</span> to send dots and dashes.</p>

                    <!-- Universal WPM moved to Header -->
                    <div class="mb-4">
                        <p class="text-sm text-gray-400">Adjust speed using the Global Control at the top of the page.
                        </p>
                    </div>

                    <div class="flex flex-col items-center">
                        <button id="keyerButton" class="keyer-button w-full rounded-2xl text-2xl font-bold shadow-xl">
                            KEYER (Press/Hold)
                        </button>
                        <p class="text-sm text-gray-400 mt-2">Hold down for a DASH (-), quick tap for a DOT (.).</p>
                    </div>

                    <div class="mt-4 p-3 bg-gray-700 rounded-lg">
                        <p class="text-sm text-gray-400 mb-2">Input Morse (Current Character):</p>
                        <p id="inputMorseDisplay" class="text-2xl h-8 break-words text-sky-400">_</p>

                        <p class="text-sm text-gray-400 mt-4 mb-2">Decoded Message:</p>
                        <p id="decodedOutput" class="text-2xl h-16 overflow-hidden">_</p>

                        <button id="clearKeyerButton"
                            class="btn-primary w-full py-2 mt-4 rounded-lg text-base bg-red-500 hover:bg-red-600 border-red-500">
                            Clear Input
                        </button>
                    </div>
                </div>

                <div class="card p-6 rounded-xl order-2">
                    <h2 class="text-3xl font-bold mb-4 border-b pb-2 border-sky-400">2. Reception Practice (Text to
                        Tone)</h2>
                    <p class="text-sm text-gray-300 mb-4">Select a speed and enter text to practice receiving.</p>

                    <div class="mb-4 pt-2">
                        <p class="text-sm text-gray-400 mb-2">Speed is controlled by the Global Slider at the top.</p>
                    </div>

                    <textarea id="inputText"
                        class="w-full h-32 p-3 rounded-lg bg-gray-700 text-white resize-none focus:ring-sky-400 focus:border-sky-400"
                        placeholder="Type your message here (A-Z, 0-9, space)"></textarea>

                    <div class="flex space-x-2 mt-4">
                        <button id="playMorseButton" class="btn-primary flex-1 py-3 rounded-lg text-lg">
                            Play
                        </button>
                        <button id="stopMorseButton"
                            class="bg-gray-600 text-white flex-1 py-3 rounded-lg text-lg hover:bg-gray-500 transition"
                            disabled>
                            Stop
                        </button>
                    </div>

                    <div class="mt-4 p-3 bg-gray-700 rounded-lg">
                        <p class="text-sm text-gray-400 mb-2">Morse Sequence:</p>
                        <p id="morseSequenceOutput" class="text-xl break-words h-10 overflow-hidden">_</p>
                        <p id="currentCharacter" class="text-center mt-4 text-4xl font-bold text-amber-300 h-10">
                            <!-- Currently playing character -->
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. Morse Code Chart -->
        <section id="morsecode" class="content-section hidden">
            <div class="card p-6 rounded-xl lg:col-span-2">
                <h3 class="text-2xl font-semibold mb-3 text-gray-100">Standard International Morse Code</h3>
                <div id="morse-chart" class="p-3"></div>
            </div>
        </section>

        <!-- 3. Part A: Operating Procedures & Rules -->
        <section id="rules" class="content-section hidden">
            <h2 class="text-3xl font-bold mb-4 text-blue-400">2. Part A: Operating Rules & Regulations</h2>
            <p class="mb-6 text-gray-400">This section covers the official rules, operating procedures, Q-codes, and
                emergency signals for the General Grade examination, based on WPC regulations and ITU rules.</p>
            <div id="rules-content" class="space-y-6"></div>
        </section>

        <!-- 4. Part B: Basic Electronics & Theory -->
        <section id="electronics" class="content-section hidden">
            <h2 class="text-3xl font-bold mb-4 text-blue-400">3. Part B: Basic Electronics Concepts</h2>
            <p class="mb-6 text-gray-400">The core concepts needed for the theory part of the exam, explained simply and
                intuitively.</p>
            <div id="electronics-content" class="space-y-6"></div>
        </section>

        <!-- 5. General Quiz Section -->
        <section id="quiz" class="content-section hidden">
            <h2 class="text-3xl font-bold mb-4 text-blue-400">4. General Grade Practice Quiz</h2>

            <div id="quiz-setup" class="card p-6 mb-8">
                <h3 class="text-2xl font-semibold mb-4 text-gray-100">Setup Your Exam Session</h3>
                <div class="space-y-4">
                    <div>
                        <label for="quiz-category" class="block text-sm font-medium text-gray-300">1. Choose Exam
                            Part:</label>
                        <select id="quiz-category"
                            class="mt-1 block w-full p-3 border border-gray-600 rounded-lg bg-gray-700 text-white">
                            <option value="rules">Part A: Rules & Procedures</option>
                            <option value="electronics">Part B: Basic Electronics</option>
                            <option value="mixed">Mixed (Both Parts)</option>
                            <option value="prosigns">Prosigns & Phonetics</option>
                        </select>
                    </div>
                    <div>
                        <label for="quiz-count" class="block text-sm font-medium text-gray-300">2. Number of
                            Questions:</label>
                        <select id="quiz-count"
                            class="mt-1 block w-full p-3 border border-gray-600 rounded-lg bg-gray-700 text-white">
                            <option value="5">5 Questions (Quick Test)</option>
                            <option value="10">10 Questions (Standard)</option>
                            <option value="20">20 Questions (Marathon)</option>
                            <option value="50">50 Questions (Mega Marathon)</option>
                        </select>
                    </div>
                    <button onclick="App.startGeneralQuiz()"
                        class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold text-lg hover:bg-blue-700 transition">
                        Start Quiz!
                    </button>
                </div>
            </div>

            <div id="quiz-active" class="hidden">
                <div id="question-card" class="card p-6 mb-6 min-h-[300px] relative">
                    <p id="question-number" class="text-sm font-medium text-blue-400 mb-2"></p>
                    <h4 id="question-text" class="text-xl font-bold mb-4 text-gray-100"></h4>
                    <div id="options-container" class="space-y-3"></div>
                    <button id="submit-btn" onclick="App.submitGeneralAnswer()"
                        class="mt-6 bg-indigo-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-indigo-600 transition disabled:opacity-50">
                        Submit Answer
                    </button>
                </div>

                <div id="feedback-card"
                    class="card p-4 bg-yellow-900 border-l-4 border-yellow-400 text-yellow-300 hidden">
                    <h5 id="feedback-title" class="font-bold text-lg mb-2"></h5>
                    <p id="feedback-explanation"></p>
                </div>

                <div class="mt-4 flex justify-between items-center text-gray-300 font-medium">
                    <span>Score: <span id="current-score" class="text-green-400 font-bold">0</span> / <span
                            id="total-questions">0</span></span>
                    <span>Progress: <span id="current-progress" class="text-blue-400 font-bold">0</span> of <span
                            id="total-progress">0</span></span>
                </div>
            </div>

            <div id="quiz-results" class="hidden text-center card p-8">
                <h3 class="text-3xl font-bold mb-4 text-gray-100">Quiz Complete!</h3>
                <div id="result-message" class="text-2xl font-semibold mb-4 text-green-400"></div>
                <p class="text-gray-300 mb-6">You got <span id="final-score" class="font-bold text-blue-400"></span> out
                    of <span id="final-total" class="font-bold text-blue-400"></span> correct.</p>
                <button onclick="showSection('quiz');"
                    class="bg-purple-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-purple-700 transition">
                    Start a New Quiz
                </button>
            </div>
        </section>

        <!-- 6. Morse Quiz -->
        <div id="content-morse" class="content-section hidden">
            <div class="card p-6 rounded-xl">
                <h2 class="text-2xl font-semibold mb-4 text-white">Morse Code Group Quiz</h2>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 items-end">
                    <div>
                        <label for="morse-length" class="block text-sm font-medium text-gray-400 mb-1">Group
                            Length</label>
                        <select id="morse-length"
                            class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 text-white focus:ring-blue-500 focus:border-blue-500">
                            <option value="1">1 Character</option>
                            <option value="2">2 Characters (Double)</option>
                            <option value="3">3 Characters (Triple)</option>
                            <option value="4">4 Characters</option>
                            <option value="998">5 Whole Words</option>
                            <option value="999">6 Full Sentences</option>
                        </select>
                    </div>
                    <div>
                        <label for="morse-mode" class="block text-sm font-medium text-gray-400 mb-1">Quiz Mode</label>
                        <select id="morse-mode"
                            class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 text-white focus:ring-blue-500 focus:border-blue-500">
                            <option value="receive">Receive (Sound -> Type)</option>
                            <option value="send">Send (Type -> Keyer Tap)</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button id="start-morse-quiz-button"
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                            Start Morse Quiz!
                        </button>
                    </div>
                </div>

                <div id="morse-quiz-area" class="mt-6 text-center card p-6">
                    <p class="text-center text-gray-400 mb-4" id="morse-message">Select length and mode, then click
                        'Start Morse Quiz!'</p>

                    <div id="morse-quiz-container" class="hidden">

                        <div class="mb-6">
                            <p class="text-lg text-gray-400" id="morse-quiz-counter">0/10</p>
                            <p id="morse-quiz-status" class="text-lg font-medium text-blue-400 mb-4"></p>
                        </div>

                        <!-- Receive Mode -->
                        <div id="receive-mode-controls" class="hidden">
                            <div class="bg-gray-800 p-6 rounded-xl mb-4">
                                <p class="text-xl font-bold text-secondary mb-4">Listen carefully...</p>
                                <button id="play-morse-quiz-button"
                                    class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg transition duration-150">
                                    <svg class="w-6 h-6 inline mr-2" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1V8a1 1 0 011-1h1.586l4.137-4.137A2 2 0 0111 3.536v16.928a2 2 0 01-.277 1.137l-4.137-4.137z">
                                        </path>
                                    </svg>
                                    Play Morse
                                </button>
                            </div>

                            <label for="morse-input-text" class="block text-sm font-medium text-gray-400 mb-2">Your
                                Answer:</label>
                            <input type="text" id="morse-input-text" maxlength="4"
                                class="w-full max-w-sm mx-auto p-3 text-2xl text-center rounded-lg bg-gray-800 border border-gray-600 text-white uppercase focus:ring-blue-500 focus:border-blue-500 rounded-none"
                                disabled>
                            <button id="submit-morse-button"
                                class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                                Submit
                            </button>
                            <p id="morse-receive-feedback" class="mt-4 text-xl font-bold"></p>
                        </div>

                        <!-- Send Mode -->
                        <div id="send-mode-controls" class="hidden">
                            <div class="bg-gray-800 p-6 rounded-xl mb-4">
                                <p class="text-sm font-medium text-gray-400 mb-2">Send the following with the Keyer:</p>
                                <p id="target-send-text" class="text-5xl font-extrabold text-secondary tracking-widest">
                                </p>
                            </div>

                            <div class="flex flex-col items-center">
                                <button id="morse-keyer-button"
                                    class="keyer-button w-48 h-16 text-2xl font-extrabold text-white rounded-xl mb-4 active:bg-red-700">
                                    KEY
                                </button>
                                <p class="text-gray-400 text-sm mb-4">Spacebar is also enabled for sending.</p>
                            </div>

                            <div class="grid grid-cols-2 gap-4 text-center mt-4">
                                <div class="bg-gray-900 p-3 rounded-lg">
                                    <h4 class="text-sm font-medium text-gray-400">Your Morse Input</h4>
                                    <p id="morse-send-input-display"
                                        class="text-xl font-mono text-yellow-400 truncate overflow-x-auto h-8 flex items-center justify-center">
                                        _</p>
                                </div>
                                <div class="bg-gray-900 p-3 rounded-lg">
                                    <h4 class="text-sm font-medium text-gray-400">Decoded</h4>
                                    <p id="morse-send-decoded-output"
                                        class="text-xl font-mono text-green-400 truncate overflow-x-auto h-8 flex items-center justify-center">
                                        _</p>
                                </div>
                            </div>

                            <p id="morse-send-feedback" class="mt-4 text-xl font-bold"></p>
                            <button id="send-next-button"
                                class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 hidden">
                                Next
                            </button>
                            <button id="send-retry-button"
                                class="mt-4 ml-2 bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 hidden">
                                Retry
                            </button>
                        </div>

                        <button id="end-morse-quiz-button"
                            class="mt-6 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 hidden">
                            End Quiz
                        </button>
                    </div>

                    <div id="morse-results-container" class="hidden mt-8 text-center card p-6">
                        <h3 class="text-3xl font-bold mb-4" id="morse-results-title">Quiz Finished!</h3>
                        <p class="text-xl mb-4 text-green-400">Final Score: <span id="morse-score-display"
                                class="font-extrabold"></span></p>
                        <p class="text-gray-400 mb-6" id="morse-score-details"></p>
                        <button onclick="document.getElementById('start-morse-quiz-button').click();"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-150">
                            Start New Morse Quiz
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 7. Syllabus -->
        <section id="syllabus" class="content-section hidden">
            <div class="card p-6 rounded-xl lg:col-span-2">
                <h2 class="text-3xl font-bold mb-4 border-b pb-2 border-green-500 text-green-400">Syllabus and
                    Examination Details (India)</h2>
                <div class="space-y-6 text-gray-300">
                    <!-- EXAM STRUCTURE -->
                    <div class="bg-gray-800 p-4 rounded-lg border border-gray-600">
                        <h3 class="text-xl font-bold text-white mb-2">Examination Structure</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-bold text-green-300">Restricted Grade</h4>
                                <ul class="list-disc list-inside text-sm text-gray-400">
                                    <li><b>Written Test:</b> 1 Hour (100 Marks)</li>
                                    <li><b>Sections:</b> Basic Radio Theory + Regulations</li>
                                    <li><b>Pass Marks:</b> 40% (Sec) / 50% (Agg)</li>
                                    <li><b>No Morse Code Test</b></li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-green-300">General Grade</h4>
                                <ul class="list-disc list-inside text-sm text-gray-400">
                                    <li><b>Written Test:</b> 2 Hours (100 Marks)</li>
                                    <li><b>Sections:</b> Advanced Radio Theory + Regulations</li>
                                    <li><b>Pass Marks:</b> 50% (Sec) / 60% (Agg)</li>
                                    <li><b>Morse Code:</b> 8 WPM (Send & Receive)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- RESTRICTED GRADE / COMMON SYLLABUS -->
                    <div>
                        <h3 class="text-2xl font-bold text-blue-400 mb-3 border-l-4 border-blue-500 pl-3">
                            Part 1: Common Syllabus (Restricted Grade Base)
                        </h3>
                        <p class="text-sm text-gray-400 mb-4">Required for both Restricted and General Grade exams.</p>

                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- Section A Common -->
                            <div>
                                <h4 class="font-bold text-lg text-white border-b border-gray-700 mb-2">Section A: Radio
                                    Theory</h4>
                                <ul class="space-y-2 text-sm text-gray-300">
                                    <li><b class="text-green-300">1. Electricity & Magnetism:</b> Passive/Active devices
                                        (Resistors, Inductors, Capacitors, Diodes, Transistors), Ohm's Law, Kirchoff's
                                        Laws, Power/Energy, Magnets.</li>
                                    <li><b class="text-green-300">2. AC Theory:</b> Sinusoidal quantities, Impedance,
                                        Resonance, Rectifiers.</li>
                                    <li><b class="text-green-300">3. Semi-conductor Devices:</b> Principles of Diodes &
                                        Transistors as amplifiers/oscillators.</li>
                                    <li><b class="text-green-300">4. Radio Receivers:</b> TRF & Superheterodyne
                                        principles, CW reception.</li>
                                    <li><b class="text-green-300">5. Transmitters:</b> Low power principles, Crystal
                                        oscillators.</li>
                                    <li><b class="text-green-300">6. Propagation:</b> EM Spectrum, Ionosphere layers,
                                        Skip distance, Fading.</li>
                                    <li><b class="text-green-300">7. Aerials:</b> Common transmitting/receiving types.
                                    </li>
                                    <li><b class="text-green-300">8. Measurement:</b> Frequency measurement.</li>
                                </ul>
                            </div>

                            <!-- Section B Common -->
                            <div>
                                <h4 class="font-bold text-lg text-white border-b border-gray-700 mb-2">Section B: Radio
                                    Regulations</h4>
                                <ul class="space-y-2 text-sm text-gray-300">
                                    <li>Indian Wireless Telegraph Rules (1973) & Amateur Service Rules (1978).</li>
                                    <li>ITU Regulations: Designation of Emission, Phonetic Alphabet, Frequency
                                        Allocation.</li>
                                    <li><b>Call Signs:</b> VU Series allocations.</li>
                                    <li><b>Procedures:</b> Interference, Tests, Secrecy of Correspondence.</li>
                                    <li><b>Distress & Urgency:</b> Signals and procedures (SOS, MAYDAY, PAN PAN).</li>
                                    <li><b>Q-Codes & Abbreviations:</b> Standard list (QRA-QUM).</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- GENERAL GRADE ADDITIONS -->
                    <div>
                        <h3 class="text-2xl font-bold text-amber-400 mb-3 border-l-4 border-amber-500 pl-3">
                            Part 2: General Grade Additions
                        </h3>
                        <p class="text-sm text-gray-400 mb-4">Additional advanced topics required ONLY for General
                            Grade.</p>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-bold text-lg text-white border-b border-gray-700 mb-2">Advanced Theory
                                </h4>
                                <ul class="space-y-2 text-sm text-gray-300">
                                    <li><b class="text-amber-300">1. Principles of Comms:</b> Analog vs Digital,
                                        Modulation (AM, FM, SSB, Pulse), Demodulation.</li>
                                    <li><b class="text-amber-300">2. Advanced AC:</b> Transformers (Construction,
                                        Losses, Matching).</li>
                                    <li><b class="text-amber-300">3. Power Supplies:</b> Half/Full wave, Bridge
                                        rectifiers, Smoothing & Regulation.</li>
                                    <li><b class="text-amber-300">4. Space Comms:</b> Satellite communication
                                        principles.</li>
                                    <li><b class="text-amber-300">5. Adv. Propagation:</b> Critical frequency, Day/Night
                                        frequencies.</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg text-white border-b border-gray-700 mb-2">Morse Code (Part
                                    II)</h4>
                                <div class="bg-gray-800 p-3 rounded">
                                    <p class="text-sm mb-2"><b>Speed:</b> 8 Words Per Minute.</p>
                                    <ul class="list-disc list-inside text-sm text-gray-400">
                                        <li><b>Receiving:</b> 5 mins plain text (200 chars).</li>
                                        <li><b>Sending:</b> 5 mins plain text.</li>
                                        <li>Classification of errors & disqualification criteria.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </section>

    </div>

    <!-- MAIN SCRIPT -->
    <script>
        (function () {
            // --- 1. DATA DEFINITIONS ---

            const MORSE_MAP = {
                'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.', 'G': '--.', 'H': '....', 'I': '..', 'J': '.---',
                'K': '-.-', 'L': '.-..', 'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.', 'S': '...', 'T': '-',
                'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-', 'Y': '-.--', 'Z': '--..',
                '1': '.----', '2': '..---', '3': '...--', '4': '....-', '5': '.....',
                '6': '-....', '7': '--...', '8': '---..', '9': '----.', '0': '-----',
                '.': '.-.-.-', ',': '--..--', '?': '..--..', '/': '-..-.', ' ': ' '
            };

            const REVERSE_MORSE = Object.fromEntries(
                Object.entries(MORSE_MAP).map(([key, value]) => [value, key])
            );

            const QUIZ_WORDS = [
                "CQ", "DE", "HAM", "RADIO", "WAVES", "EXAM", "PREP", "TEST", "SEVEN", "THREE", "HELLO", "CODE", "GOOD",
                "QRL", "QRM", "QRN", "QRO", "QRQ", "QRS", "QRT", "QRV", "QRZ", "QSB", "QSL", "QSY", "QTH", "QTR",
                "CUL", "SK", "AR", "K", "RIG", "WATT", "COAX", "SWR", "AMPLIFIER", "ANTENNA", "POWER", "TOWER", "KEYER"
            ];
            const QUIZ_SENTENCES = [
                "CQ DE HAM", "KNOW YOUR LIMITS", "RADIO WAVES ARE FAST", "GOOD LUCK WITH THE TEST", "QTH IS DELHI",
                "THE QUICK BROWN FOX", "SEND MORE CODE", "WELCOME ABOARD", "QRL IS THIS FREQUENCY BUSY"
            ];

            // *** PLACEHOLDERS FOR LARGE DATA TO KEEP FILE SIZE MANAGEABLE IN THIS TOOL ***
            // Ideally these should be loaded from the previous values or external files.
            // I will include the critical structure.

            const RULES_CONTENT = [
                {
                    title: "License Categories & Eligibility (Amateur Service Rules, 1978 & 1973)",
                    content: `
                        <p>The WPC (Wireless Planning & Coordination Wing) issues two main categories of licenses for individuals based on the **Indian Wireless Telegraph Rules, 1973** and the **Amateur Service Rules, 1978 and amendments**:</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300">
                            <li><b>Amateur Wireless Telegraph Station License (GENERAL)</b></li>
                            <li><b>Amateur Wireless Telegraph Station License (RESTRICTED)</b></li>
                        </ul>
                        <p class="mt-3">To be eligible, you must be:</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300">
                            <li>A citizen of India.</li>
                            <li>At least 18 years of age. (Relaxed to 14 for General, 12 for Restricted).</li>
                            <li>Have passed the Amateur Station Operators' Examination (ASOC) for the required grade.</li>
                        </ul>
                    `
                },
                {
                    title: "Amateur Station Regulations (ITU Art. 25)",
                    content: `
                        <p>An amateur station (Art. 25) is for personal, non-commercial use only. You are <b>strictly forbidden</b> to transmit:</p>
                        <ul class="list-disc list-inside mt-2 space-y-2 ml-4 text-red-300">
                            <li>Music, broadcast programmes, or any entertainment.</li>
                            <li>Advertisements or any communications for business (no "pecuniary interest").</li>
                            <li>False or misleading signals (like a fake "MAYDAY"). (Art. 19)</li>
                            <li>Messages for or on behalf of third parties (with one major exception...).</li>
                            <li>Any matter which is indecent, obscene, or offensive.</li>
                            <li>Statements on political or industrial controversy.</li>
                        </ul>
                    `
                },
                {
                    title: "Emergency & Third-Party Messages (1978 Rules)",
                    content: `
                        <p>The rule against transmitting for third parties has one crucial exception: <b>EMERGENCIES!</b></p>
                        <p class="mt-2">In the event of a failure of normal communication systems (per the 1978 rules), you are <b>PERMITTED</b> to handle third-party messages related to:</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-green-300">
                            <li>Natural calamities like earthquakes, floods, or cyclones.</li>
                            <li>Widespread fires or other major disasters.</li>
                        </ul>
                        <p class="mt-3"><b>The Condition:</b> These messages must originate from or be addressed to a competent civil authority (like a District Magistrate). You must also inform the licensing authority (WPC) by letter after you use your station for this purpose.</p>
                    `
                },
                {
                    title: "Distress and Urgency Signals (ITU Art. 30, 31, 32 & 33)",
                    content: `
                        <p>Articles 30-33 cover the protocol for handling safety and distress. These signals have absolute priority:</p>
                        <ul class="list-disc list-inside mt-2 space-y-3 ml-4">
                            <li><span class="text-2xl font-bold text-red-400">MAYDAY</span> (spoken 3 times):<br>
                                <b>Meaning:</b> **Distress Signal**. Grave and imminent danger, requires immediate assistance.</li>
                            <li><span class="text-2xl font-bold text-yellow-400">PAN PAN</span> (spoken 3 times):<br>
                                <b>Meaning:</b> **Urgency Signal**. A serious situation concerning safety, but **no immediate danger**. Priority over everything except MAYDAY.</li>
                            <li><span class="text-2xl font-bold text-blue-300">SECURITE</span> (spoken 3 times):<br>
                                <b>Meaning:</b> **Safety Signal**. Transmitting a message concerning safety of navigation or important meteorological warnings.</li>
                        </ul>
                    `
                },
                {
                    title: "Interference & Tests (ITU Art. 15)",
                    content: `
                        <p>Article 15 governs interference and station tests. Your station must not endanger other services or "seriously degrade, obstruct, or repeatedly interrupt" any other radio service.</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300">
                            <li><b>Listen First:</b> Always listen to ensure the frequency is clear before transmission.</li>
                            <li><b>Stop if Causing Harm:</b> If you are told you are causing interference, you must stop or restrict transmissions immediately.</li>
                            <li><b>Tests:</b> Keep tests (like calling "VVV" or a short carrier) as short as possible. Use a dummy load for longer, internal equipment tests.</li>
                        </ul>
                    `
                },
                {
                    title: "Nomenclature of Frequency & Wavelength (ITU Art. 2)",
                    content: `
                        <p>Article 2 defines the naming conventions for the radio spectrum bands:</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300">
                            <li><b>VLF</b> (Very Low Frequency): 3 - 30 kHz</li>
                            <li><b>LF</b> (Low Frequency): 30 - 300 kHz</li>
                            <li><b>MF</b> (Medium Frequency): 300 - 3000 kHz</li>
                            <li><b>HF</b> (High Frequency): <b>3 - 30 MHz</b> (The primary long-distance band)</li>
                            <li><b>VHF</b> (Very High Frequency): <b>30 - 300 MHz</b> (Includes 2m band)</li>
                            <li><b>UHF</b> (Ultra High Frequency): <b>300 - 3000 MHz</b> (Includes 70cm band)</li>
                        </ul>
                    `
                },
                {
                    title: "Frequency Allocation for Amateur Services (ITU Art. 5)",
                    content: `
                        <p>Article 5 is the global frequency allocation master table. For General Grade Indian amateurs, the key allocated bands are:</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300">
                            <li><b>HF Bands:</b> 80m (3.5 MHz), 40m (7.0 MHz), 20m (14.0 MHz), 15m (21.0 MHz), 10m (28.0 MHz), and others.</li>
                            <li><b>VHF Band:</b> 2m (144 - 146 MHz)</li>
                            <li><b>UHF Band:</b> 70cm (434 - 438 MHz)</li>
                        </ul>
                        <p class="mt-2">Many bands are **shared**, meaning amateurs must not interfere with primary services in those segments.</p>
                    `
                },
                {
                    title: "Emission Designations (ITU Appendix-I)",
                    content: `
                        <p>Appendix-I provides the code for *what* your signal is (e.g., J3E for voice). A designation has three parts:</p>
                        <ul class="list-disc list-inside mt-2 space-y-2 ml-4">
                            <li><b>First Letter (Modulation):</b> <b>A</b> (AM), <b>F</b> (FM), <b>J</b> (Single Sideband, suppressed carrier).</li>
                            <li><b>Second Number (Modulating Signal):</b> <b>1</b> (Digital, no sub-carrier, e.g., CW), <b>3</b> (Analogue, voice/sound).</li>
                            <li><b>Third Letter (Information):</b> <b>A</b> (Telegraphy for aural reception - Morse), <b>E</b> (Telephony - voice).</li>
                        </ul>
                        <p class="mt-3 font-semibold">Key codes to know:</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-blue-300">
                            <li><b>A1A:</b> CW (Morse Code - pure carrier keyed).</li>
                            <li><b>J3E:</b> SSB Voice (Common on HF).</li>
                            <li><b>F3E:</b> FM Voice (Common on VHF/UHF repeaters).</li>
                        </ul>
                    `
                },
                {
                    title: "Call Signs & Identification (ITU Art. 19 & App. 42)",
                    content: `
                        <p>Your call sign is your international ID (Art. 19). You must transmit it at the start, end, and at least every 10 minutes during transmission.</p>
                        <p class="mt-2"><b>Indian Call Signs (Appendix 42):</b> The ITU allocates blocks of call signs. India is allocated:</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300">
                            <li><b>ATA - AWZ</b></li>
                            <li><b>VTA - VWZ</b> (The VU block comes from this)</li>
                            <li><b>8TA - 8YZ</b></li>
                        </ul>
                    `
                },
                {
                    title: "Standard Frequency and Time Signals Services",
                    content: `
                        <p>These services provide synchronized time and a stable frequency reference across the world (e.g., for setting your radio's clock).</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300">
                            <li><b>WWV</b> & <b>WWVH:</b> Operated by the USA (NIST).</li>
                            <li><b>CHU:</b> Operated by Canada.</li>
                            <li><b>ATA:</b> Operated by **India** (National Physical Laboratory, New Delhi).</li>
                        </ul>
                    `
                },
                {
                    title: "Q-Codes: The Full List (Syllabus)",
                    content: `
                        <p>Here are the Q-Codes you are required to know for the exam. They are a fast way to exchange common information.</p>
                        <div class="simple-list mt-3">
                            <div class="simple-list-item"><b>QRA:</b> What is the name of your station?</div>
                            <div class="simple-list-item"><b>QRG:</b> What is my exact frequency?</div>
                            <div class="simple-list-item"><b>QRH:</b> Does my frequency vary?</div>
                            <div class="simple-list-item"><b>QRI:</b> How is my tone? (1-3)</div>
                            <div class="simple-list-item"><b>QRK:</b> What is my readability? (1-5)</div>
                            <div class="simple-list-item"><b>QRL:</b> Are you busy? (I am busy)</div>
                            <div class="simple-list-item"><b>QRM:</b> Are you being interfered with? (Man-made)</div>
                            <div class="simple-list-item"><b>QRN:</b> Are you troubled by static? (Natural)</div>
                            <div class="simple-list-item"><b>QRO:</b> Shall I increase power?</div>
                            <div class="simple-list-item"><b>QRS:</b> Shall I send more slowly?</div>
                            <div class="simple-list-item"><b>QRT:</b> Shall I stop sending?</div>
                            <div class="simple-list-item"><b>QRU:</b> Have you anything for me? (No)</div>
                            <div class="simple-list-item"><b>QRV:</b> Are you ready?</div>
                            <div class="simple-list-item"><b>QRW:</b> Shall I inform... you are calling?</div>
                            <div class="simple-list-item"><b>QRX:</b> When will you call again? (Stand by)</div>
                            <div class="simple-list-item"><b>QRZ:</b> Who is calling me?</div>
                            <div class="simple-list-item"><b>QSA:</b> What is my signal strength? (1-5)</div>
                            <div class="simple-list-item"><b>QSB:</b> Are my signals fading?</div>
                            <div class="simple-list-item"><b>QSL:</b> Can you acknowledge receipt? (I acknowledge)</div>
                            <div class="simple-list-item"><b>QSO:</b> Can you communicate with...?</div>
                            <div class="simple-list-item"><b>QSU:</b> Shall I reply on this frequency?</div>
                            <div class="simple-list-item"><b>QSV:</b> Shall I send 'V's? (For test)</div>
                            <div class="simple-list-item"><b>QSW:</b> Will you send on this frequency?</div>
                            <div class="simple-list-item"><b>QSX:</b> Will you listen to... on...?</div>
                            <div class="simple-list-item"><b>QSY:</b> Shall I change frequency?</div>
                            <div class="simple-list-item"><b>QSZ:</b> Shall I send each word twice?</div>
                            <div class="simple-list-item"><b>QTC:</b> How many messages to send?</div>
                            <div class="simple-list-item"><b>QTH:</b> What is your location?</div>
                            <div class="simple-list-item"><b>QTR:</b> What is the correct time?</div>
                            <div class="simple-list-item"><b>QUM:</b> Is the distress traffic over?</div>
                        </div>
                    `
                },
                {
                    title: "Common Abbreviations (CW & Voice)",
                    content: `
                        <p>These abbreviations are used to speed up conversations, especially in Morse Code (CW).</p>
                        <div class="simple-list mt-3">
                            <div class="simple-list-item"><b>AA:</b> All after</div>
                            <div class="simple-list-item"><b>AB:</b> All before</div>
                            <div class="simple-list-item"><b>AR:</b> End of message (End of transmission)</div>
                            <div class="simple-list-item"><b>AS:</b> Wait / Stand by</div>
                            <div class="simple-list-item"><b>C:</b> Yes / Correct</div>
                            <div class="simple-list-item"><b>CFM:</b> Confirm</div>
                            <div class="simple-list-item"><b>CL:</b> Closing down station</div>
                            <div class="simple-list-item"><b>CQ:</b> Calling any station</div>
                            <div class="simple-list-item"><b>DE:</b> From (e.g., "VU2XYZ DE VU3ABC")</div>
                            <div class="simple-list-item"><b>K:</b> Go ahead and transmit (Over)</div>
                            <div class="simple-list-item"><b>NIL:</b> Nothing</div>
                            <div class="simple-list-item"><b>OK:</b> Correct / Agreed</div>
                            <div class="simple-list-item"><b>R:</b> Received (Roger)</div>
                            <div class="simple-list-item"><b>TU:</b> Thank You</div>
                            <div class="simple-list-item"><b>VA:</b> End of work (Signing off - SK)</div>
                            <div class="simple-list-item"><b>WA:</b> Word after</div>
                            <div class="simple-list-item"><b>WB:</b> Word before</div>
                        </div>
                    `
                },
                {
                    title: "The Phonetic Alphabet (ITU Appendix 14)",
                    content: `
                        <p>To avoid confusion, especially in noisy conditions, we use the International Phonetic Alphabet (Appendix 14). This is mandatory knowledge!</p>
                        <div class="phonetic-table mt-4">
                            <div class="phonetic-item"><div class="phonetic-letter">A</div><div class="phonetic-word">Alfa</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">B</div><div class="phonetic-word">Bravo</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">C</div><div class="phonetic-word">Charlie</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">D</div><div class="phonetic-word">Delta</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">E</div><div class="phonetic-word">Echo</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">F</div><div class="phonetic-word">Foxtrot</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">G</div><div class="phonetic-word">Golf</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">H</div><div class="phonetic-word">Hotel</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">I</div><div class="phonetic-word">India</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">J</div><div class="phonetic-word">Juliett</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">K</div><div class="phonetic-word">Kilo</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">L</div><div class="phonetic-word">Lima</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">M</div><div class="phonetic-word">Mike</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">N</div><div class="phonetic-word">November</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">O</div><div class="phonetic-word">Oscar</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">P</div><div class="phonetic-word">Papa</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">Q</div><div class="phonetic-word">Quebec</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">R</div><div class="phonetic-word">Romeo</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">S</div><div class="phonetic-word">Sierra</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">T</div><div class="phonetic-word">Tango</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">U</div><div class="phonetic-word">Uniform</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">V</div><div class="phonetic-word">Victor</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">W</div><div class="phonetic-word">Whiskey</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">X</div><div class="phonetic-word">X-ray</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">Y</div><div class="phonetic-word">Yankee</div></div>
                            <div class="phonetic-item"><div class="phonetic-letter">Z</div><div class="phonetic-word">Zulu</div></div>
                        </div>
                    `
                },
                {
                    title: "Signal Reporting: The RST System",
                    content: `
                        <p class="text-gray-300 mb-6">The RST system is the standard way to report signal quality (Readability, Strength, Tone). A report consists of three numbers (e.g., "599").</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <!-- R Column -->
                            <div class="bg-gray-700/50 p-6 rounded-xl border border-gray-600">
                                <h4 class="text-xl font-bold text-green-400 mb-2 border-b border-gray-600 pb-2">R - Readability</h4>
                                <p class="text-xs text-gray-400 mb-4">How easy is it to copy?</p>
                                <ul class="space-y-2 text-sm text-gray-300">
                                    <li><b>1:</b> Unreadable</li>
                                    <li><b>2:</b> Barely readable, occasional words</li>
                                    <li><b>3:</b> Readable with considerable difficulty</li>
                                    <li><b>4:</b> Readable with practically no difficulty</li>
                                    <li><b>5:</b> Perfectly readable</li>
                                </ul>
                            </div>

                            <!-- S Column -->
                            <div class="bg-gray-700/50 p-6 rounded-xl border border-gray-600">
                                <h4 class="text-xl font-bold text-blue-400 mb-2 border-b border-gray-600 pb-2">S - Strength</h4>
                                <p class="text-xs text-gray-400 mb-4">How strong is the signal?</p>
                                <ul class="space-y-2 text-sm text-gray-300">
                                    <li><b>1:</b> Faint, barely perceptible</li>
                                    <li><b>2:</b> Very weak</li>
                                    <li><b>3:</b> Weak</li>
                                    <li><b>4:</b> Fair</li>
                                    <li><b>5:</b> Fairly good</li>
                                    <li><b>6:</b> Good</li>
                                    <li><b>7:</b> Moderately strong</li>
                                    <li><b>8:</b> Strong</li>
                                    <li><b>9:</b> Extremely strong</li>
                                </ul>
                            </div>

                            <!-- T Column -->
                            <div class="bg-gray-700/50 p-6 rounded-xl border border-gray-600">
                                <h4 class="text-xl font-bold text-purple-400 mb-2 border-b border-gray-600 pb-2">T - Tone</h4>
                                <p class="text-xs text-gray-400 mb-4">CW/Morse note quality (omit for Voice)</p>
                                <ul class="space-y-2 text-sm text-gray-300">
                                    <li><b>1:</b> Sixty cycle A.C., very rough</li>
                                    <li><b>3:</b> Rough A.C. tone</li>
                                    <li><b>5:</b> Filtered rectified A.C.</li>
                                    <li><b>7:</b> Near pure tone</li>
                                    <li><b>9:</b> Perfect tone</li>
                                </ul>
                            </div>
                        </div>

                        <p class="text-sm text-gray-400 italic"><b>Note:</b> For voice (SSB/FM), we only report RS (e.g., "59"). Tone is only for CW.</p>
                    `
                }
            ];

            const ELECTRONICS_CONTENT = [
                {
                    title: "1. Electricity & Magnetism",
                    content: `
            <div class="space-y-4 text-gray-300">
                <div>
                    <h4 class="font-bold text-green-300">Fundamental Units</h4>
                    <ul class="list-disc list-inside ml-2">
                        <li><b>Ampere (I):</b> Unit of Current (flow of electrons).</li>
                        <li><b>Volt (E):</b> Unit of EMF / Potential Difference.</li>
                        <li><b>Ohm (R):</b> Unit of Resistance.</li>
                        <li><b>Watt (P):</b> Unit of Power.</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-green-300">Ohm's Law</h4>
                    <p class="font-mono bg-gray-700 p-2 rounded inline-block">I = E / R</p>
                    <p class="text-sm mt-1">Current is directly proportional to Voltage and inversely proportional to Resistance.</p>
                </div>
                <div>
                    <h4 class="font-bold text-green-300">Components</h4>
                    <ul class="list-disc list-inside ml-2">
                        <li><b>Resistor:</b> Opposes current flow. Color codes identify value.</li>
                        <li><b>Capacitor (Farads):</b> Stores energy in an electric field. Blocks DC, passes AC.</li>
                        <li><b>Inductor (Henries):</b> Stores energy in a magnetic field. Opposes changes in current.</li>
                    </ul>
                </div>
            </div>
        `
                },
                {
                    title: "2. AC Theory & Circuits",
                    content: `
            <div class="space-y-4 text-gray-300">
                <div>
                    <h4 class="font-bold text-green-300">AC Characteristics</h4>
                    <p>Alternating Current (AC) reverses direction periodically. <b>Frequency (Hz)</b> is cycles per second.</p>
                </div>
                <div>
                    <h4 class="font-bold text-green-300">Reactance & Impedance</h4>
                    <ul class="list-disc list-inside ml-2">
                        <li><b>Inductive Reactance (XL):</b> Increases with frequency. (XL = 2fL)</li>
                        <li><b>Capacitive Reactance (XC):</b> Decreases with frequency. (XC = 1/2fC)</li>
                        <li><b>Impedance (Z):</b> Total opposition to AC (Resistance + Reactance).</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-green-300">Resonance</h4>
                    <p>Occurs when XL = XC. In a series LC circuit, impedance is minimum. In parallel, impedance is maximum.</p>
                </div>
            </div>
        `
                },
                {
                    title: "3. Semiconductors & Transistors",
                    content: `
            <div class="space-y-4 text-gray-300">
                <div>
                    <h4 class="font-bold text-green-300">Diodes</h4>
                    <p>Allow current in one direction (Rectification). Used in power supplies and detectors. Zener diodes regulate voltage.</p>
                </div>
                <div>
                    <h4 class="font-bold text-green-300">Transistors (BJT)</h4>
                    <p>Three terminals: <b>Emitter, Base, Collector</b>. Used as switches or amplifiers.</p>
                    <ul class="list-disc list-inside ml-2">
                        <li><b>NPN / PNP:</b> Types of BJT.</li>
                        <li><b>Alpha ():</b> Current gain (common base), always &lt; 1.</li>
                        <li><b>Beta ():</b> Current gain (common emitter), usually high (50-200).</li>
                    </ul>
                </div>
            </div>
        `
                },
                {
                    title: "4. Amplifiers",
                    content: `
            <div class="space-y-4 text-gray-300">
                <p>Increase the strength of a signal. Classified by operating point (Bias).</p>
                <ul class="list-disc list-inside ml-2 space-y-2">
                    <li><b>Class A:</b> Conducts 360 of cycle. Low distortion, low efficiency.</li>
                    <li><b>Class B:</b> Conducts 180 of cycle. Higher efficiency, crossover distortion. (Push-Pull eliminates even harmonics)</li>
                    <li><b>Class C:</b> Conducts &lt; 180. High efficiency, high distortion. Used in RF transmitters.</li>
                </ul>
            </div>
        `
                },
                {
                    title: "5. Oscillators",
                    content: `
            <div class="space-y-4 text-gray-300">
                <p>Generate AC signals from DC. Requires <b>Positive Feedback</b>.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                    <div class="bg-gray-700 p-2 rounded"><b>Hartley:</b> Uses split inductor (tapped coil) for feedback.</div>
                    <div class="bg-gray-700 p-2 rounded"><b>Colpitts:</b> Uses capacitive voltage divider for feedback.</div>
                    <div class="bg-gray-700 p-2 rounded"><b>Crystal:</b> Uses quartz crystal for high stability (Piezoelectric effect).</div>
                </div>
            </div>
        `
                },
                {
                    title: "6. Transmitters & Receivers",
                    content: `
            <div class="space-y-4 text-gray-300">
                <div>
                    <h4 class="font-bold text-green-300">Transmitter Stages</h4>
                    <p>Oscillator -> Buffer -> Driver -> Power Amplifier (PA) -> Antenna.</p>
                    <p class="text-sm">Modulation happens at different stages depending on mode (AM/FM/SSB).</p>
                </div>
                <div>
                    <h4 class="font-bold text-green-300">Superheterodyne Receiver</h4>
                    <p>Converts incoming RF to a fixed <b>Intermediate Frequency (IF)</b> for better selectivity and sensitivity.</p>
                    <p class="text-sm mt-1">Microphone -> RF Amp -> Mixer (+ Local Oscillator) -> IF Amp -> Detector -> Audio Amp -> Speaker.</p>
                </div>
            </div>
        `
                },
                {
                    title: "7. Propagation & Antennas",
                    content: `
            <div class="space-y-4 text-gray-300">
                <div>
                    <h4 class="font-bold text-green-300">Propagation</h4>
                    <ul class="list-disc list-inside ml-2">
                        <li><b>Ground Wave:</b> Follows earth's curvature (LF/MF).</li>
                        <li><b>Sky Wave:</b> Refracts off Ionosphere (HF). Enables DX. Affected by Solar Cycle.</li>
                        <li><b>Line of Sight:</b> Direct path (VHF/UHF).</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-green-300">Antennas</h4>
                    <ul class="list-disc list-inside ml-2">
                        <li><b>Dipole:</b> Length is /2. Impedance ~73.</li>
                        <li><b>Yagi-Uda:</b> Directional with gain. (Director, Driver, Reflector).</li>
                        <li><b>Ground Plane:</b> Vertical omnidirectional.</li>
                    </ul>
                </div>
            </div>
        `
                }
            ];

            const QUIZ_QUESTIONS = [
                // --- CATEGORY: RULES ---
                {
                    "category": "rules",
                    "question": "What is the fee for a 'Life Long' General Grade license (up to 80 years)?",
                    "options": ["Rs 1000", "Rs 2000", "Rs 100", "Rs 500"],
                    "answer": "Rs 2000",
                    "explanation": "The fee for a lifelong Amateur Station Operator Certificate (General or Restricted) is Rs. 2000."
                },
                {
                    "category": "rules",
                    "question": "When must an amateur station identify itself?",
                    "options": ["Only at start", "Only at end", "At least once every 10 minutes", "Never"],
                    "answer": "At least once every 10 minutes",
                    "explanation": "Regulations require identification at least once every 10 minutes during transmission."
                },
                {
                    "category": "rules",
                    "question": "Call signs for General Grade in India start with:",
                    "options": ["VU3", "VU2", "VU1", "VU4"],
                    "answer": "VU2",
                    "explanation": "General Grade licenses typically use the VU2 prefix, while Restricted Grade uses VU3."
                },
                {
                    "category": "rules",
                    "question": "What is the standard repeater shift in the VHF band?",
                    "options": ["5 MHz", "600 kHz", "1 MHz", "900 kHz"],
                    "answer": "600 kHz",
                    "explanation": "The standard offset for VHF (2m band) repeaters is 600 kHz."
                },
                {
                    "category": "rules",
                    "question": "What Q-code is used to ask 'Is the distress traffic over?'",
                    "options": ["QUM", "QRT", "QTC", "QRV"],
                    "answer": "QUM",
                    "explanation": "QUM is the Q-code for 'Is the distress traffic over?'"
                },
                {
                    "category": "rules",
                    "question": "What Q-code is used to ask 'Shall I change frequency?'",
                    "options": ["QSY", "QRG", "QRX", "QSU"],
                    "answer": "QSY",
                    "explanation": "QSY is the Q-code for 'Shall I change frequency?'"
                },
                {
                    "category": "rules",
                    "question": "What Q-code is used to ask 'Are you busy?'",
                    "options": ["QRL", "QRM", "QRZ", "QRV"],
                    "answer": "QRL",
                    "explanation": "QRL is the code for 'Are you busy?'"
                },

                // --- CATEGORY: PROSIGNS & PHONETICS ---
                {
                    "category": "prosigns",
                    "question": "What does the procedural signal 'AR' indicate?",
                    "options": ["All Received", "End of transmission / End of message", "Awaiting Reply", "Ask to Repeat"],
                    "answer": "End of transmission / End of message",
                    "explanation": "'AR' is sent at the end of a message or transmission."
                },
                {
                    "category": "prosigns",
                    "question": "What does the procedural signal 'SOS' indicate?",
                    "options": ["Urgency", "Safety", "Distress", "Routine"],
                    "answer": "Distress",
                    "explanation": "SOS is the international distress signal."
                },
                {
                    "category": "prosigns",
                    "question": "What is the NATO phonetic word for the letter 'F'?",
                    "options": ["Fast", "Foxtrot", "Final", "Fire"],
                    "answer": "Foxtrot",
                    "explanation": "The phonetic word for 'F' is Foxtrot."
                },
                {
                    "category": "prosigns",
                    "question": "What is the NATO phonetic word for the letter 'Q'?",
                    "options": ["Quick", "Quake", "Quebec", "Quasar"],
                    "answer": "Quebec",
                    "explanation": "The phonetic word for 'Q' is Quebec."
                },
                {
                    "category": "prosigns",
                    "question": "What does '73' mean?",
                    "options": ["Best Regards", "Love and Kisses", "Goodbye", "I have no messages"],
                    "answer": "Best Regards",
                    "explanation": "73 is the standard code for 'Best Regards'."
                },

                // --- CATEGORY: ELECTRONICS ---
                {
                    "category": "electronics",
                    "question": "What is the unit of electrical resistance?",
                    "options": ["Volt", "Ohm", "Ampere", "Watt"],
                    "answer": "Ohm",
                    "explanation": "Resistance is measured in Ohms ()."
                },
                {
                    "category": "electronics",
                    "question": "Which particle carries negative charge in an atom?",
                    "options": ["Proton", "Neutron", "Electron", "Photon"],
                    "answer": "Electron",
                    "explanation": "Electrons carry negative charge."
                },
                {
                    "category": "electronics",
                    "question": "Ohm's law is written as which equation?",
                    "options": ["V = I  R", "I = V  R", "P = VI", "V = IR^2"],
                    "answer": "V = I  R",
                    "explanation": "Ohm's law relates voltage, current and resistance."
                },
                {
                    "category": "electronics",
                    "question": "Which component stores energy in an electric field?",
                    "options": ["Inductor", "Capacitor", "Resistor", "Transformer"],
                    "answer": "Capacitor",
                    "explanation": "Capacitors store energy in an electric field."
                },
                {
                    "category": "electronics",
                    "question": "Power dissipated in a resistor can be calculated by which formula?",
                    "options": ["P = V  I", "P = R/I", "P = V^2  I", "P = I^3 R"],
                    "answer": "P = V  I",
                    "explanation": "Power = voltage  current."
                },
                {
                    "category": "electronics",
                    "question": "What is the relationship between frequency f and period T?",
                    "options": ["T = f", "T = 1/f", "f = 2T", "f = T^2"],
                    "answer": "T = 1/f",
                    "explanation": "Period is inverse of frequency."
                },
                {
                    "category": "electronics",
                    "question": "Resonance in an RLC circuit occurs when which condition holds?",
                    "options": ["R = 0", "XL = XC", "V = I", "Q = 0"],
                    "answer": "XL = XC",
                    "explanation": "At resonance inductive and capacitive reactances cancel."
                },
                {
                    "category": "electronics",
                    "question": "A P-N junction diode allows current to flow in which direction?",
                    "options": ["Both directions equally", "Only from P to N (forward)", "Only from N to P in reverse", "Neither direction"],
                    "answer": "Only from P to N (forward)",
                    "explanation": "Diodes conduct when forward biased."
                },
                {
                    "category": "electronics",
                    "question": "Which device is typically used for rectification in a power supply?",
                    "options": ["Transistor", "Diode", "Inductor", "Capacitor"],
                    "answer": "Diode",
                    "explanation": "Diodes convert AC to DC by rectification."
                },
                {
                    "category": "electronics",
                    "question": "Which propagation mode is mainly responsible for long-distance HF communication?",
                    "options": ["Space wave", "Ground wave", "Sky wave (ionospheric)", "Surface wave"],
                    "answer": "Sky wave (ionospheric)",
                    "explanation": "Sky wave refracted by ionosphere enables long-distance HF contacts."
                },
                {
                    "category": "electronics",
                    "question": "The voltage ratio of an ideal transformer equals which ratio?",
                    "options": ["Np/Ns", "Ns/Np", "Vp/Vs", "Ns  Np"],
                    "answer": "Ns/Np",
                    "explanation": "Vs/Vp = Ns/Np (turns ratio)."
                }
            ];


            // --- 2. AUDIO SYSTEM ---
            const AudioSys = {
                ctx: null,
                wpm: 12,
                freq: 700,

                init() {
                    if (!this.ctx) {
                        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                    }
                    if (this.ctx.state === 'suspended') {
                        this.ctx.resume();
                    }
                },

                getTiming() {
                    const t = 1.2 / this.wpm; // Dot duration in seconds
                    return {
                        dot: t,
                        dash: t * 3,
                        symbolSpace: t,
                        charSpace: t * 3,
                        wordSpace: t * 7
                    };
                },

                playTone(duration) {
                    return new Promise(resolve => {
                        const osc = this.ctx.createOscillator();
                        const gain = this.ctx.createGain();
                        osc.type = 'sine';
                        osc.frequency.value = this.freq;
                        osc.connect(gain);
                        gain.connect(this.ctx.destination);

                        const now = this.ctx.currentTime;
                        gain.gain.setValueAtTime(1, now);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + duration);

                        osc.start(now);
                        osc.stop(now + duration);

                        setTimeout(resolve, duration * 1000);
                    });
                },

                async playSequence(text, onCharStart) {
                    this.init();
                    const timing = this.getTiming();

                    for (let char of text.toUpperCase()) {
                        if (onCharStart) onCharStart(char);

                        if (char === ' ') {
                            await new Promise(r => setTimeout(r, timing.wordSpace * 1000));
                            continue;
                        }

                        const code = MORSE_MAP[char];
                        if (!code) continue;

                        for (let part of code) {
                            const d = part === '.' ? timing.dot : timing.dash;
                            await this.playTone(d);
                            await new Promise(r => setTimeout(r, timing.symbolSpace * 1000));
                        }
                        await new Promise(r => setTimeout(r, timing.charSpace * 1000));
                    }
                    if (onCharStart) onCharStart(null); // End
                }
            };

            // --- 3. APP UI LOGIC ---
            const App = {
                init() {

                    this.setupGlobalControls();
                    this.renderCharts();
                    this.renderContent(RULES_CONTENT, 'rules-content');
                    this.renderContent(ELECTRONICS_CONTENT, 'electronics-content');

                    // Initialize Tabs
                    window.showSection = (id) => {
                        document.querySelectorAll('.content-section').forEach(el => el.classList.add('hidden'));
                        document.getElementById(id).classList.remove('hidden');
                        document.querySelectorAll('.tab-button').forEach(btn => {
                            const onclick = btn.getAttribute('onclick');
                            if (onclick && onclick.includes(id)) btn.classList.add('active');
                            else btn.classList.remove('active');
                        });
                        if (id === 'quiz') this.resetGeneralQuiz();
                    };

                    // Add Event Listeners
                    this.setupPracticeMode();
                    this.setupMorseQuiz();
                },

                setupGlobalControls() {
                    const slider = document.getElementById('global-wpm-slider');
                    const valDisplay = document.getElementById('global-wpm-value');

                    // Sync initial
                    slider.value = AudioSys.wpm;
                    valDisplay.innerText = AudioSys.wpm;

                    slider.addEventListener('input', (e) => {
                        AudioSys.wpm = parseInt(e.target.value);
                        valDisplay.innerText = AudioSys.wpm;
                    });

                    // Global Spacebar Handler
                    document.addEventListener('keydown', (e) => {
                        if (e.code === 'Space' && !e.repeat) {
                            if (!document.getElementById('morsepractice').classList.contains('hidden')) {
                                // Practice Mode
                                e.preventDefault();
                                // Trigger mousedown on button
                                const btn = document.getElementById('keyerButton');
                                if (btn) btn.dispatchEvent(new Event('mousedown'));
                            } else if (!document.getElementById('content-morse').classList.contains('hidden')) {
                                // Quiz Mode
                                const sendMode = !document.getElementById('send-mode-controls').classList.contains('hidden');
                                if (sendMode) {
                                    e.preventDefault();
                                    const btn = document.getElementById('morse-keyer-button');
                                    if (btn) btn.dispatchEvent(new Event('mousedown'));
                                }
                            }
                        }
                    });

                    document.addEventListener('keyup', (e) => {
                        if (e.code === 'Space') {
                            if (!document.getElementById('morsepractice').classList.contains('hidden')) {
                                e.preventDefault();
                                const btn = document.getElementById('keyerButton');
                                if (btn) btn.dispatchEvent(new Event('mouseup'));
                            } else if (!document.getElementById('content-morse').classList.contains('hidden')) {
                                const sendMode = !document.getElementById('send-mode-controls').classList.contains('hidden');
                                if (sendMode) {
                                    e.preventDefault();
                                    const btn = document.getElementById('morse-keyer-button');
                                    if (btn) btn.dispatchEvent(new Event('mouseup'));
                                }
                            }
                        }
                    });
                },

                renderContent(data, elementId) {
                    const container = document.getElementById(elementId);
                    if (!container) return;
                    container.innerHTML = data.map(item => `
                        <div class="rounded-2xl shadow-lg transition-all duration-300 overflow-hidden border border-opacity-50 animate-slide-up bg-gray-800 border-gray-700 hover:shadow-xl mb-6">
                            <div class="p-6 md:p-8 relative">
                                <h3 class="text-2xl font-bold mb-6 pr-8 text-blue-400">${item.title}</h3>
                                <div class="prose max-w-none leading-relaxed text-gray-300 space-y-3">${item.content}</div>
                            </div>
                        </div>
                    `).join('');
                },

                renderCharts() {
                    const el = document.getElementById('morse-chart');
                    if (!el) return;

                    el.innerHTML = Object.entries(MORSE_MAP).map(([k, v]) => {
                        if (k === ' ') return '';
                        // Generate a safe ID for the element
                        const safeId = 'chart-item-' + k.replace(/[.\-,?\/]/g, (m) => {
                            if (m === '.') return 'dot';
                            if (m === '-') return 'dash';
                            if (m === ',') return 'comma';
                            if (m === '?') return 'ques';
                            if (m === '/') return 'slash';
                            return 'sym';
                        }).trim();

                        return `<div id="${safeId}" onclick="App.playChartAudio('${k}', '${safeId}')" 
                                class="p-2 bg-gray-700 rounded border border-gray-600 flex justify-between items-center cursor-pointer hover:bg-gray-600 transition select-none active:scale-95 group relative overflow-hidden">
                        <span class="font-bold text-white group-hover:text-blue-300 transition text-lg z-10">${k}</span>
                        <div class="flex items-center space-x-2 z-10">
                            <span class="text-blue-400 font-mono group-hover:text-white transition font-bold">${v}</span>
                            <svg class="w-4 h-4 text-gray-500 group-hover:text-blue-300 transition opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1V8a1 1 0 011-1h1.586l4.137-4.137A2 2 0 0111 3.536v16.928a2 2 0 01-.277 1.137l-4.137-4.137z"></path>
                            </svg>
                        </div>
                    </div>`;
                    }).join('');
                    el.className = 'grid grid-cols-2 md:grid-cols-4 gap-2';
                },

                playChartAudio(char, elementId) {
                    const el = document.getElementById(elementId);
                    if (el) {
                        el.classList.remove('bg-gray-700', 'border-gray-600');
                        el.classList.add('bg-blue-600', 'border-blue-400', 'ring-2', 'ring-blue-300');
                    }

                    AudioSys.playSequence(char).then(() => {
                        if (el) {
                            el.classList.add('bg-gray-700', 'border-gray-600');
                            el.classList.remove('bg-blue-600', 'border-blue-400', 'ring-2', 'ring-blue-300');
                        }
                    });
                },

                // --- MORSE PRACTICE ---
                setupPracticeMode() {
                    // Universal WPM is handled in setGlobalControls
                    // const slider = document.getElementById('practice-wpm-slider');
                    // const valDisplay = document.getElementById('practice-wpm-value');
                    const playBtn = document.getElementById('playMorseButton');
                    const stopBtn = document.getElementById('stopMorseButton');
                    const input = document.getElementById('inputText');
                    const display = document.getElementById('morseSequenceOutput');
                    const charDisplay = document.getElementById('currentCharacter');

                    // slider listener removed

                    playBtn.addEventListener('click', () => {
                        const text = input.value;
                        if (!text) return;

                        playBtn.disabled = true;
                        stopBtn.disabled = false;

                        AudioSys.playSequence(text, (char) => {
                            if (char) {
                                charDisplay.innerText = char;
                                const code = MORSE_MAP[char];
                                if (code) display.innerText += " " + code;
                                else if (char === ' ') display.innerHTML += ' <span class="text-gray-500">/</span> ';
                            } else {
                                playBtn.disabled = false;
                                stopBtn.disabled = true;
                                charDisplay.innerText = "DONE";
                            }
                        });
                    });

                    stopBtn.addEventListener('click', () => {
                        // Primitive stop for now: just reload page or throw error in audio loop (omitted for brevity)
                        window.location.reload();
                    });

                    // Keyer Logic
                    const keyerBtn = document.getElementById('keyerButton');
                    const keyerInput = document.getElementById('inputMorseDisplay');
                    const decodedText = document.getElementById('decodedOutput');
                    const clearKeyer = document.getElementById('clearKeyerButton');

                    let keyPressStart = 0;
                    let keySequence = "";
                    let keyTimeout = null;

                    const processKey = () => {
                        const char = REVERSE_MORSE[keySequence];
                        if (char) decodedText.innerText += char;
                        keySequence = "";
                        keyerInput.innerText = "_";
                    };

                    const down = (e) => {
                        if (e.cancelable) e.preventDefault();
                        if (keyPressStart !== 0) return;
                        keyPressStart = Date.now();
                        AudioSys.init();

                        // Start Oscillator for Practice
                        this.practiceOsc = AudioSys.ctx.createOscillator();
                        const gain = AudioSys.ctx.createGain();
                        this.practiceOsc.frequency.value = AudioSys.freq;
                        this.practiceOsc.connect(gain);
                        gain.connect(AudioSys.ctx.destination);
                        this.practiceOsc.start();

                        keyerBtn.classList.add('bg-blue-400');
                        if (keyTimeout) clearTimeout(keyTimeout);
                    };

                    const up = (e) => {
                        if (e.cancelable) e.preventDefault();
                        if (keyPressStart === 0) return;

                        // Stop Oscillator
                        if (this.practiceOsc) {
                            try { this.practiceOsc.stop(); } catch (err) { }
                            this.practiceOsc = null;
                        }

                        const dur = Date.now() - keyPressStart;
                        keyPressStart = 0;
                        keyerBtn.classList.remove('bg-blue-400');

                        const dotDur = (1.2 / AudioSys.wpm) * 1000;
                        const char = dur < dotDur * 2.5 ? '.' : '-';
                        keySequence += char;
                        keyerInput.innerText = keySequence;

                        keyTimeout = setTimeout(processKey, dotDur * 4);
                    };

                    keyerBtn.addEventListener('mousedown', down);
                    keyerBtn.addEventListener('mouseup', up);
                    keyerBtn.addEventListener('touchstart', down);
                    keyerBtn.addEventListener('touchend', up);

                    clearKeyer.addEventListener('click', () => {
                        decodedText.innerText = "";
                        keySequence = "";
                        keyerInput.innerText = "_";
                    });
                },

                // --- MORSE QUIZ ---
                morseQuizState: {
                    active: false,
                    mode: 'receive', // 'receive' or 'send'
                    lengthType: '1',
                    score: 0,
                    qIndex: 0,
                    list: [],
                    userAnswer: null,
                    answered: false,
                    sendInput: ""
                },

                setupMorseQuiz() {
                    const startBtn = document.getElementById('start-morse-quiz-button');
                    startBtn.addEventListener('click', () => {
                        this.startMorseQuiz();
                    });

                    // Receive Mode Events
                    document.getElementById('play-morse-quiz-button').addEventListener('click', () => {
                        this.playMorseQuestion();
                    });

                    document.getElementById('submit-morse-button').addEventListener('click', () => {
                        this.submitMorseAnswer();
                    });

                    document.getElementById('morse-input-text').addEventListener('keyup', (e) => {
                        if (e.key === 'Enter') this.submitMorseAnswer();
                    });

                    // Send Mode Events
                    document.getElementById('morse-keyer-button').addEventListener('mousedown', (e) => this.handleQuizKeyDown(e));
                    document.getElementById('morse-keyer-button').addEventListener('mouseup', (e) => this.handleQuizKeyUp(e));
                    document.getElementById('morse-keyer-button').addEventListener('touchstart', (e) => this.handleQuizKeyDown(e));
                    document.getElementById('morse-keyer-button').addEventListener('touchend', (e) => this.handleQuizKeyUp(e));

                    // Send Mode "Next" button (acts as Submit/Continue)
                    document.getElementById('send-next-button').addEventListener('click', () => {
                        this.nextMorseQuestion(); // In Send mode, we just move on or score?
                        // Actually, let's make it submit first if not answered
                        if (!this.morseQuizState.answered) {
                            this.checkSendAnswer(); // Auto-check if they click next? Or maybe we need a dedicated "Check" button.
                            // Let's treat 'send-next-button' as "Submit/Next"
                        } else {
                            this.nextMorseQuestion();
                        }
                    });

                    document.getElementById('send-retry-button').addEventListener('click', () => {
                        this.retrySendQuestion();
                    });

                    document.getElementById('end-morse-quiz-button').addEventListener('click', () => {
                        this.endMorseQuiz();
                    });
                },

                startMorseQuiz() {
                    const lenVal = document.getElementById('morse-length').value;
                    const modeVal = document.getElementById('morse-mode').value;

                    this.morseQuizState = {
                        active: true,
                        mode: modeVal,
                        lengthType: lenVal,
                        score: 0,
                        qIndex: 0,
                        list: this.generateMorseQuestions(lenVal),
                        userAnswer: null,
                        answered: false,
                        sendInput: ""
                    };

                    // UI Toggle
                    document.getElementById('morse-quiz-container').classList.remove('hidden');
                    document.getElementById('morse-message').classList.add('hidden');

                    // Reset Result View
                    document.getElementById('morse-results-container').classList.add('hidden');

                    // Set Mode UI
                    if (modeVal === 'receive') {
                        document.getElementById('receive-mode-controls').classList.remove('hidden');
                        document.getElementById('send-mode-controls').classList.add('hidden');
                    } else {
                        document.getElementById('receive-mode-controls').classList.add('hidden');
                        document.getElementById('send-mode-controls').classList.remove('hidden');
                    }

                    document.getElementById('end-morse-quiz-button').classList.remove('hidden');

                    this.renderMorseQuestion();
                },

                generateMorseQuestions(type) {
                    const count = 10;
                    const list = [];
                    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

                    for (let i = 0; i < count; i++) {
                        if (type === '998') { // Words
                            list.push(QUIZ_WORDS[Math.floor(Math.random() * QUIZ_WORDS.length)]);
                        } else if (type === '999') { // Sentences
                            list.push(QUIZ_SENTENCES[Math.floor(Math.random() * QUIZ_SENTENCES.length)]);
                        } else {
                            // Random groups
                            const len = parseInt(type);
                            let str = "";
                            for (let j = 0; j < len; j++) {
                                str += chars.charAt(Math.floor(Math.random() * chars.length));
                            }
                            list.push(str);
                        }
                    }
                    return list;
                },

                renderMorseQuestion() {
                    const state = this.morseQuizState;
                    if (state.qIndex >= state.list.length) {
                        this.showMorseResults();
                        return;
                    }

                    const currentQ = state.list[state.qIndex];

                    // Update Status
                    document.getElementById('morse-quiz-counter').innerText = `Question ${state.qIndex + 1} / ${state.list.length}`;
                    document.getElementById('morse-quiz-status').innerText = "In Progress...";

                    // Reset Inputs/Feedback
                    state.answered = false;
                    state.userAnswer = null;
                    state.sendInput = "";

                    if (state.mode === 'receive') {
                        const input = document.getElementById('morse-input-text');
                        input.value = "";
                        input.disabled = false;
                        input.focus();
                        document.getElementById('morse-receive-feedback').innerText = "";
                        document.getElementById('morse-receive-feedback').className = "mt-4 text-xl font-bold";

                        const subBtn = document.getElementById('submit-morse-button');
                        subBtn.innerText = "Submit";
                        subBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                        subBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        subBtn.disabled = false;

                        // Auto-play maybe? No, let user click play.
                    } else {
                        // SEND MODE
                        document.getElementById('target-send-text').innerText = currentQ;
                        document.getElementById('morse-send-input-display').innerText = "_";
                        document.getElementById('morse-send-decoded-output').innerText = "_";
                        document.getElementById('morse-send-feedback').innerText = "";

                        const nextBtn = document.getElementById('send-next-button');
                        nextBtn.innerText = "Submit";
                        nextBtn.classList.remove('hidden');

                        const retryBtn = document.getElementById('send-retry-button');
                        retryBtn.classList.remove('hidden');
                    }
                },

                playMorseQuestion() {
                    const state = this.morseQuizState;
                    const q = state.list[state.qIndex];
                    const btn = document.getElementById('play-morse-quiz-button');
                    btn.disabled = true;
                    AudioSys.playSequence(q, null).then(() => {
                        btn.disabled = false;
                    });
                },

                submitMorseAnswer() {
                    const state = this.morseQuizState;
                    if (state.answered) {
                        this.nextMorseQuestion();
                        return;
                    }

                    const input = document.getElementById('morse-input-text');
                    const val = input.value.toUpperCase().trim();
                    const correct = state.list[state.qIndex].toUpperCase();

                    state.userAnswer = val;
                    state.answered = true;

                    const fb = document.getElementById('morse-receive-feedback');
                    if (val === correct) {
                        state.score++;
                        fb.innerText = "CORRECT! Good job.";
                        fb.classList.add('text-green-400');
                    } else {
                        fb.innerHTML = `INCORRECT. Answer was <span class="text-amber-300">${correct}</span>`;
                        fb.classList.add('text-red-400');
                    }

                    input.disabled = true;
                    const subBtn = document.getElementById('submit-morse-button');
                    subBtn.innerText = "Next Question ";
                    subBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    subBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                },

                // --- Keyer Logic for Quiz (Reusing some concepts but isolated) ---
                quizKeyStart: 0,
                quizKeyTimeout: null,

                handleQuizKeyDown(e) {
                    e.preventDefault();
                    if (this.quizKeyStart !== 0 || this.morseQuizState.answered) return;
                    this.quizKeyStart = Date.now();
                    AudioSys.init();
                    AudioSys.ctx.resume(); // Ensure audio context is resume

                    // Visual feedback
                    document.getElementById('morse-keyer-button').classList.add('bg-blue-400');

                    // Play tone
                    const osc = AudioSys.ctx.createOscillator();
                    const gain = AudioSys.ctx.createGain();
                    osc.frequency.value = AudioSys.freq;
                    osc.connect(gain);
                    gain.connect(AudioSys.ctx.destination);
                    osc.start();
                    this.quizCurrentOsc = osc; // Store to stop later
                },


                quizKeySequence: "",

                handleQuizKeyUp(e) {
                    e.preventDefault();
                    if (this.quizKeyStart === 0 || this.morseQuizState.answered) return;

                    if (this.quizCurrentOsc) {
                        this.quizCurrentOsc.stop();
                        this.quizCurrentOsc = null;
                    }

                    const dur = Date.now() - this.quizKeyStart;
                    this.quizKeyStart = 0;
                    document.getElementById('morse-keyer-button').classList.remove('bg-blue-400');

                    const dotDur = (1.2 / AudioSys.wpm) * 1000;
                    const char = dur < dotDur * 2.5 ? '.' : '-';

                    this.quizKeySequence += char;

                    // Show current forming char
                    // document.getElementById('morse-send-input-display').innerText = ... (maybe show dots/dashes for current char)

                    if (this.quizKeyTimeout) clearTimeout(this.quizKeyTimeout);
                    this.quizKeyTimeout = setTimeout(() => this.commitQuizChar(), dotDur * 4);
                },

                commitQuizChar() {
                    const code = this.quizKeySequence;
                    const letter = REVERSE_MORSE[code];

                    const displayInput = document.getElementById('morse-send-input-display');
                    const displayDecoded = document.getElementById('morse-send-decoded-output');

                    if (letter) {
                        displayDecoded.innerText = (displayDecoded.innerText === '_' ? '' : displayDecoded.innerText) + letter;
                        this.morseQuizState.userAnswer = (this.morseQuizState.userAnswer || "") + letter;
                    }

                    // Append the raw code to display for visual feedback
                    displayInput.innerText = (displayInput.innerText === '_' ? '' : displayInput.innerText) + " " + code;

                    this.quizKeySequence = "";
                },

                checkSendAnswer() {
                    const state = this.morseQuizState;
                    const correct = state.list[state.qIndex].replace(/ /g, ''); // Remove spaces for comparison?
                    const user = (state.userAnswer || "").replace(/ /g, '');

                    // Allow partial match if it's very long? No, exact match.
                    // But wait, spaces in sentences? 
                    // My keyer logic above doesn't easily handle "Space" (pause).
                    // For simplicity, let's strip spaces from Target if the Keyer doesn't support Space.
                    // OR, support Space bar for Space?
                    // Let's just strip spaces for "Send" validation to be lenient.

                    const isCorrect = (user === correct); // Strict for now, ignoring space issue if we strip.

                    state.answered = true;
                    const fb = document.getElementById('morse-send-feedback');
                    if (isCorrect) {
                        state.score++;
                        fb.innerText = "Perfect Sending!";
                        fb.classList.add('text-green-400');
                    } else {
                        fb.innerText = "Not quite. Match failed.";
                        fb.classList.add('text-red-400');
                    }

                    const btn = document.getElementById('send-next-button');
                    btn.innerText = "Next Question ";

                    // Hide retry button after submission
                    document.getElementById('send-retry-button').classList.add('hidden');
                },

                retrySendQuestion() {
                    if (this.morseQuizState.answered) return; // Cannot retry after submitting

                    this.morseQuizState.userAnswer = null;
                    this.morseQuizState.sendInput = "";
                    this.quizKeySequence = "";

                    document.getElementById('morse-send-input-display').innerText = "_";
                    document.getElementById('morse-send-decoded-output').innerText = "_";
                    document.getElementById('morse-send-feedback').innerText = "";

                    document.getElementById('morse-send-feedback').classList.remove('text-green-400', 'text-red-400');
                },

                nextMorseQuestion() {
                    if (this.morseQuizState.mode === 'send' && !this.morseQuizState.answered) {
                        this.checkSendAnswer(); // If they clicked "Submit/Check"
                        return; // Don't move next yet, let them see result
                    }

                    this.morseQuizState.qIndex++;
                    this.renderMorseQuestion();
                },

                showMorseResults() {
                    document.getElementById('morse-quiz-container').classList.add('hidden');
                    document.getElementById('morse-results-container').classList.remove('hidden');

                    const state = this.morseQuizState;
                    document.getElementById('morse-score-display').innerText = `${state.score} / ${state.list.length}`;

                    const msg = document.getElementById('morse-score-details');
                    if (state.score === state.list.length) msg.innerText = "CW Master! Perfect score.";
                    else if (state.score >= 5) msg.innerText = "Good job! Keep practicing.";
                    else msg.innerText = "Keep practicing. You'll get there!";
                },

                endMorseQuiz() {
                    document.getElementById('morse-quiz-container').classList.add('hidden');
                    document.getElementById('morse-message').classList.remove('hidden');
                    document.getElementById('end-morse-quiz-button').classList.add('hidden');
                    this.morseQuizState.active = false;
                },

                // --- GENERAL QUIZ ---
                generalQuizState: { score: 0, qIndex: 0, list: [], userAnswer: null, answered: false },

                startGeneralQuiz() {
                    const catEl = document.getElementById('quiz-category');
                    const countEl = document.getElementById('quiz-count');
                    if (!catEl || !countEl) return;

                    const cat = catEl.value;
                    const count = parseInt(countEl.value);

                    let questions = QUIZ_QUESTIONS;
                    if (cat !== 'mixed') {
                        questions = QUIZ_QUESTIONS.filter(q => q.category === cat);
                    }

                    if (questions.length === 0) {
                        alert("No questions available for this category.");
                        return;
                    }

                    // Shuffle
                    questions = [...questions].sort(() => 0.5 - Math.random()).slice(0, count);

                    this.generalQuizState = { score: 0, qIndex: 0, list: questions, userAnswer: null, answered: false };

                    document.getElementById('quiz-setup').classList.add('hidden');
                    document.getElementById('quiz-active').classList.remove('hidden');
                    document.getElementById('quiz-results').classList.add('hidden');

                    this.renderGeneralQuestion();
                },

                renderGeneralQuestion() {
                    const state = this.generalQuizState;
                    if (state.qIndex >= state.list.length) {
                        this.showGeneralResults();
                        return;
                    }

                    const q = state.list[state.qIndex];
                    document.getElementById('question-number').innerText = `Question ${state.qIndex + 1} / ${state.list.length}`;
                    document.getElementById('question-text').innerText = q.question;

                    const optsContainer = document.getElementById('options-container');
                    optsContainer.innerHTML = '';

                    const options = [...q.options].sort(() => 0.5 - Math.random());

                    options.forEach(opt => {
                        const lbl = document.createElement('label');
                        lbl.className = "flex items-center p-3 border border-gray-600 rounded-lg cursor-pointer hover:bg-gray-700 transition w-full mb-2";
                        // Escape quotes in value
                        const safeOpt = opt.replace(/"/g, '&quot;');
                        lbl.innerHTML = `
                             <input type="radio" name="g-quiz-opt" value="${safeOpt}" class="mr-3 w-4 h-4 text-blue-500 focus:ring-blue-500 bg-gray-600">
                             <span class="text-gray-200">${opt}</span>
                        `;
                        const input = lbl.querySelector('input');
                        input.addEventListener('change', () => {
                            state.userAnswer = opt; // Use original string for comparison
                            document.getElementById('submit-btn').disabled = false;
                        });
                        optsContainer.appendChild(lbl);
                    });

                    const btn = document.getElementById('submit-btn');
                    btn.innerText = "Submit Answer";
                    btn.disabled = true;
                    btn.classList.remove('bg-green-600', 'hover:bg-green-700');
                    btn.classList.add('bg-indigo-500', 'hover:bg-indigo-600');

                    document.getElementById('feedback-card').classList.add('hidden');

                    document.getElementById('current-score').innerText = state.score;
                    document.getElementById('total-questions').innerText = state.list.length;
                    document.getElementById('current-progress').innerText = state.qIndex + 1;
                    document.getElementById('total-progress').innerText = state.list.length;
                },

                submitGeneralAnswer() {
                    const state = this.generalQuizState;
                    const btn = document.getElementById('submit-btn');

                    if (state.answered) {
                        state.qIndex++;
                        state.answered = false;
                        state.userAnswer = null;
                        this.renderGeneralQuestion();
                        return;
                    }

                    if (!state.userAnswer) return;

                    const q = state.list[state.qIndex];
                    const isCorrect = (state.userAnswer === q.answer);
                    state.answered = true;

                    const feedback = document.getElementById('feedback-card');
                    const fbTitle = document.getElementById('feedback-title');
                    const fbExp = document.getElementById('feedback-explanation');

                    feedback.classList.remove('hidden', 'bg-red-900', 'border-red-400', 'text-red-300', 'bg-green-900', 'border-green-400', 'text-green-300');

                    if (isCorrect) {
                        state.score++;
                        document.getElementById('current-score').innerText = state.score;
                        feedback.classList.add('bg-green-900', 'border-green-400', 'text-green-300');
                        fbTitle.innerText = "Correct!";
                        fbExp.innerText = q.explanation || "Great!";
                    } else {
                        feedback.classList.add('bg-red-900', 'border-red-400', 'text-red-300');
                        fbTitle.innerText = "Incorrect.";
                        fbExp.innerText = `Correct answer: ${q.answer}. ${q.explanation || ''}`;
                    }

                    document.querySelectorAll('input[name="g-quiz-opt"]').forEach(el => el.disabled = true);

                    btn.innerText = "Next Question ";
                    btn.disabled = false;
                    btn.classList.remove('bg-indigo-500', 'hover:bg-indigo-600');
                    btn.classList.add('bg-green-600', 'hover:bg-green-700');
                },

                showGeneralResults() {
                    document.getElementById('quiz-active').classList.add('hidden');
                    document.getElementById('quiz-results').classList.remove('hidden');

                    const state = this.generalQuizState;
                    document.getElementById('final-score').innerText = state.score;
                    document.getElementById('final-total').innerText = state.list.length;

                    const pct = (state.score / state.list.length) * 100;
                    const msg = document.getElementById('result-message');
                    if (pct >= 80) msg.innerText = "Excellent! You passed!";
                    else if (pct >= 50) msg.innerText = "Good effort. Keep studying.";
                    else msg.innerText = "Study more and try again.";
                },

                resetGeneralQuiz() {
                    document.getElementById('quiz-setup').classList.remove('hidden');
                    document.getElementById('quiz-active').classList.add('hidden');
                    document.getElementById('quiz-results').classList.add('hidden');
                }
            };

            window.App = App;
            window.onload = () => App.init();

        })();
    </script>
</body>

</html>
