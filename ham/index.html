<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>General & Restricted Grade Ham Radio Exam Prep Guide (India)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        /* Custom font import and basic styling */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
		        :root {
             /* --primary: #38bdf8; Sky 400 */
			--primary: #3b82f6; /* Sky 400 */
            --secondary: #fcd34d; /* Amber 300 */
            --bg-dark: #1f2937; /* Gray 800 */
            --bg-light: #4b5563; /* Gray 600 */
        }
        body {
            font-family: 'Inter', sans-serif;
            /* Dark Theme Background and default text color */
            background-color: #1a202c; /* dark slate gray */
            color: #e2e8f0; /* light gray text */
            min-height: 100vh;
        }
        /* Custom styling for cards and shadows */
        .card {
            /* Slightly lighter dark background for cards */
            background: #2d3748; /* dark gray */
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }
		        .card2 {
            /* Slightly lighter dark background for cards */
            background: #2d3748; /* dark gray */
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card2:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }
        .tab-button.active {
            background-color: #3b82f6; /* bright blue-500 */
            color: white;
            font-weight: 600;
        }
        .dot-dash {
            font-family: monospace;
            font-weight: bold;
            letter-spacing: 2px;
            color: #60a5fa; /* light blue for morse */
        }
        /* Simple table for phonetics */
        .phonetic-table {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }
        .phonetic-item {
            background-color: #374151; /* gray-700 */
            border-radius: 0.5rem;
            padding: 0.75rem;
            text-align: center;
        }
        .phonetic-letter {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fff;
        }
        .phonetic-word {
            font-size: 1rem;
            color: #60a5fa; /* light blue-400 */
        }
        /* Simple table for lists */
        .simple-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.5rem;
        }
        .simple-list-item {
            background-color: #374151; /* gray-700 */
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            font-family: monospace;
        }
		
		.btn-primary {
          background-color: var(--primary);
          color: var(--bg-dark);
          font-weight: 700;
          border: 2px solid var(--primary);
          transition: all 0.15s;
        }
        .btn-primary:hover {
            background-color: #0ea5e9; /* Sky 500 */
            transform: translateY(-1px);
        }
        .btn-primary:active {
            transform: translateY(1px);
        }
        .keyer-button {
            height: 150px;
            background-color: var(--primary);
            border: 4px solid var(--secondary);
            animation: pulse-border 2s infinite;
        }
        .keyer-button:active {
            background-color: #0ea5e9;
            box-shadow: 0 0 40px var(--primary);
        }
        .dot { color: var(--secondary); }
        .dash { color: var(--primary); }

        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(252, 211, 77, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(252, 211, 77, 0); }
            100% { box-shadow: 0 0 0 0 rgba(252, 211, 77, 0); }
        }
		
    </style>
</head>
<body class="p-4 md:p-8 text-gray-100">

    <div id="app" class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-50">General & Restricted Grade Ham Radio Exam Prep Guide (India) <span class="text-xl text-blue-400">General Grade</span></h1>
            <p class="text-gray-400 mt-2">Your interactive study guide for the ASOC Examination.</p>
        </header>

        <nav class="flex overflow-x-auto justify-start bg-gray-800 p-2 rounded-xl shadow-lg mb-8 space-x-2">
			<button class="tab-button px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200" onclick="showSection('morsecode')">Morse Code</button>
            <button class="tab-button active px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200" onclick="showSection('morsepractice')">Morse Practice</button>
            <button class="tab-button px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200" onclick="showSection('rules')">Part A: Rules</button>
            <button class="tab-button px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200" onclick="showSection('electronics')">Part B: Electronics</button>
            <button class="tab-button px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200" onclick="showSection('quiz')">Quiz Time!</button>
			<button class="tab-button px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200" onclick="showSection('content-morse')">Morse Quiz</button>
			<button class="tab-button px-4 py-2 text-sm md:text-base rounded-lg transition text-gray-200" onclick="showSection('syllabus')">Syllabus</button>
        </nav>

        <section id="morsepractice" class="content-section">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <div class="card p-6 rounded-xl order-1">
            <h2 class="text-3xl font-bold mb-4 border-b pb-2 border-amber-300">1. Transmission Practice (Keyer)</h2>
            <p class="text-sm text-gray-300 mb-4">Click the keyer button or hold the <span class="font-bold text-amber-300">SPACEBAR</span> to send dots and dashes.</p>
            
            <div class="flex flex-col items-center">
                <button id="keyerButton" class="keyer-button w-full rounded-2xl text-2xl font-bold shadow-xl">
                    KEYER (Press/Hold)
                </button>
                <p class="text-sm text-gray-400 mt-2">Hold down for a DASH (-), quick tap for a DOT (.).</p>
            </div>

            <div class="mt-4 p-3 bg-gray-700 rounded-lg">
                <div class="mb-4 pt-2">
                    <label for="wordSpeedSlider" class="text-sm font-medium text-gray-300 w-28">
					Speed :<span id="wordSpeedValue" class="text-amber-300 font-bold text-lg">8</span> WPM
					</label>
					<div class="flex items-center space-x-3">
					<span class="text-sm text-gray-400">4 WPM</span>
                    <input type="range" id="wordSpeedSlider" min="1" max="40" value="8" class="flex-grow h-2 bg-gray-700 rounded-lg cursor-pointer">
					<span class="text-sm text-gray-400">40 WPM</span>
					</div>
                </div>
                <p class="text-sm text-gray-400 mb-2">Input Morse (Current Character):</p>
                <p id="inputMorseDisplay" class="text-2xl h-8 break-words text-sky-400">_</p>
                
                <p class="text-sm text-gray-400 mt-4 mb-2">Decoded Message:</p>
                <p id="decodedOutput" class="text-2xl h-16 overflow-hidden">_</p>
                
                <button id="clearKeyerButton" class="btn-primary w-full py-2 mt-4 rounded-lg text-base bg-red-500 hover:bg-red-600 border-red-500">
                    Clear Input
                </button>
            </div>
        </div>
        
      <div class="card p-6 rounded-xl order-2">
                <h2 class="text-3xl font-bold mb-4 border-b pb-2 border-sky-400">2. Reception Practice (Text to Tone)</h2>
                <p class="text-sm text-gray-300 mb-4">Select a speed and enter text to practice receiving.</p>

                <div class="mb-4 pt-2">
                    <label class="block text-sm font-medium text-gray-300 mb-3" for="wpmRange">
                        Speed: <span id="wpmValue" class="text-amber-300 font-bold text-lg">10</span> WPM
                    </label>
                    <div class="flex items-center space-x-3">
                        <span class="text-sm text-gray-400">4 WPM</span>
                        <input type="range" id="wpmRange" min="4" max="40" value="10" step="1" class="flex-grow h-2 bg-gray-700 rounded-lg cursor-pointer">
                        <span class="text-sm text-gray-400">40 WPM</span>
                    </div>
                </div>
                
                <textarea id="inputText" class="w-full h-32 p-3 rounded-lg bg-gray-700 text-white resize-none focus:ring-sky-400 focus:border-sky-400" placeholder="Type your message here (A-Z, 0-9, space)"></textarea>
                
                <div class="flex space-x-2 mt-4">
                    <button id="playMorseButton" class="btn-primary flex-1 py-3 rounded-lg text-lg">
                        Play
                    </button>
                    <button id="stopMorseButton" class="btn-secondary flex-1 py-3 rounded-lg text-lg" disabled>
                        Stop
                    </button>
                </div>
                <div class="mt-4 p-3 bg-gray-700 rounded-lg">
                    <p class="text-sm text-gray-400 mb-2">Morse Sequence:</p>
                    <p id="morseSequenceOutput" class="text-xl break-words h-10 overflow-hidden">_</p>
                    <p id="currentCharacter" class="text-center mt-4 text-4xl font-bold text-amber-300 h-10">
                        </p>
                </div>
            </div>
    </div> </section>


<section id="morsecode" class="content-section">
    <div class="card p-6 rounded-xl lg:col-span-2">
        <h3 class="text-2xl font-semibold mb-3 text-gray-100">Standard International Morse Code</h3>
        <div id="morse-chart" class="p-3">
            </div>
    </div>
</section>


        <section id="rules" class="content-section hidden">
            <h2 class="text-3xl font-bold mb-4 text-blue-400">2. Part A: Operating Rules & Regulations</h2>
            <p class="mb-6 text-gray-400">This section covers the official rules, operating procedures, Q-codes, and emergency signals for the General Grade examination, based on WPC regulations and ITU rules. **All required syllabus topics are included below.**</p>

            <div id="rules-content" class="space-y-6"></div>
        </section>

        <section id="electronics" class="content-section hidden">
            <h2 class="text-3xl font-bold mb-4 text-blue-400">3. Part B: Basic Electronics Concepts</h2>
            <p class="mb-6 text-gray-400">The core concepts needed for the theory part of the exam, explained simply and intuitively.</p>

            <div id="electronics-content" class="space-y-6"></div>
        </section>

        <section id="quiz" class="content-section hidden">
            <h2 class="text-3xl font-bold mb-4 text-blue-400">4. General Grade Practice Quiz</h2>

            <div id="quiz-setup" class="card p-6 mb-8">
                <h3 class="text-2xl font-semibold mb-4 text-gray-100">Setup Your Exam Session</h3>
                <div class="space-y-4">
                    <div>
                        <label for="quiz-category" class="block text-sm font-medium text-gray-300">1. Choose Exam Part:</label>
                        <select id="quiz-category" class="mt-1 block w-full p-3 border border-gray-600 rounded-lg bg-gray-700 text-white">
                            <option value="rules">Part A: Rules & Procedures</option>
                            <option value="electronics">Part B: Basic Electronics</option>
                            <option value="mixed">Mixed (Both Parts)</option>
							<option value="prosigns">Prosigns & Phonetics</option>
                        </select>
                    </div>
                    <div>
                        <label for="quiz-count" class="block text-sm font-medium text-gray-300">2. Number of Questions:</label>
                        <select id="quiz-count" class="mt-1 block w-full p-3 border border-gray-600 rounded-lg bg-gray-700 text-white">
                            <option value="5">5 Questions (Quick Test)</option>
                            <option value="10">10 Questions (Standard)</option>
                            <option value="20">20 Questions (Marathon)</option>
                        </select>
                    </div>
                    <button onclick="startQuiz()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold text-lg hover:bg-blue-700 transition">
                        Start Quiz!
                    </button>
                </div>
            </div>

            <div id="quiz-active" class="hidden">
                <div id="question-card" class="card p-6 mb-6 min-h-[300px] relative">
                    <p id="question-number" class="text-sm font-medium text-blue-400 mb-2"></p>
                    <h4 id="question-text" class="text-xl font-bold mb-4 text-gray-100"></h4>
                    <div id="options-container" class="space-y-3">
                        </div>
                    <button id="submit-btn" onclick="submitAnswer()" class="mt-6 bg-indigo-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-indigo-600 transition disabled:opacity-50">
                        Submit Answer
                    </button>
                </div>

                <div id="feedback-card" class="card p-4 bg-yellow-900 border-l-4 border-yellow-400 text-yellow-300 hidden">
                    <h5 id="feedback-title" class="font-bold text-lg mb-2"></h5>
                    <p id="feedback-explanation"></p>
                </div>

                <div class="mt-4 flex justify-between items-center text-gray-300 font-medium">
                    <span>Score: <span id="current-score" class="text-green-400 font-bold">0</span> / <span id="total-questions">0</span></span>
                    <span>Progress: <span id="current-progress" class="text-blue-400 font-bold">0</span> of <span id="total-progress">0</span></span>
                </div>
            </div>

            <div id="quiz-results" class="hidden text-center card p-8">
                <h3 class="text-3xl font-bold mb-4 text-gray-100">Quiz Complete!</h3>
                <div id="result-message" class="text-2xl font-semibold mb-4 text-green-400"></div>
                <p class="text-gray-300 mb-6">You got <span id="final-score" class="font-bold text-blue-400"></span> out of <span id="final-total" class="font-bold text-blue-400"></span> correct.</p>
                <button onclick="showSection('quiz'); resetQuizSetup();" class="bg-purple-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-purple-700 transition">
                    Start a New Quiz
                </button>
            </div>

        </section>

<section id="syllabus" class="content-section hidden">
    <div class="card p-6 rounded-xl lg:col-span-2">
        <h2 class="text-3xl font-bold mb-4 border-b pb-2 border-green-500 text-green-400">
            Syllabus and Examination Details (India)
        </h2>
        
        <p class="text-lg font-semibold text-gray-200 mb-4">
            SYLLABUS AND DETAILS OF EXAMINATIONS FOR THE AWARD OF AMATEUR STATION OPERATOR’S LICENCE (Restricted) and (General) in India.
        </p>

        <h3 class="text-xl font-bold mt-6 mb-3 text-amber-300">Examination Structure</h3>
        <div class="space-y-4 text-gray-300">
            <p>The examination shall consist of the following two parts:</p>
            
            <div class="p-3 bg-gray-700 rounded-lg">
                <p class="font-semibold text-white">PART I – Written Test</p>
                <ul class="list-disc list-inside ml-4 mt-2 space-y-2">
                    <li>**Section A: Radio Theory and Practice**
                        <p class="text-sm text-gray-400 mt-1">
                            *Note: Applicants holding a degree/diploma in Engineering/Science with electronics or telecommunications are **exempted** from Section A.*
                        </p>
                    </li>
                    <li>**Section B: National and International Telecommunication Union (ITU) Radio Regulations** applicable to amateur station operation.</li>
                </ul>
            </div>
            
            <div class="p-3 bg-gray-700 rounded-lg">
                <p class="font-semibold text-white">PART II – Morse (Only for General Certificate)</p>
                <p>Morse reception and sending **(8 words per minute - wpm)**.</p>
            </div>
        </div>

        <h3 class="text-xl font-bold mt-8 mb-3 text-amber-300">DETAILED SYLLABUS</h3>

        <div class="mt-6 p-4 border border-gray-600 rounded-lg">
            <h4 class="text-2xl font-bold text-sky-400 border-b pb-2 mb-3">Restricted Examination</h4>
            
            <p class="font-semibold text-white">Part I – Written Test (1 Hour)</p>
            
            <p class="mt-2 font-medium text-gray-200">Section A: Radio Theory and Practice</p>
            <ul class="list-disc list-inside ml-4 text-sm space-y-1 text-gray-300">
                <li>**Elementary Electricity and Magnetism:** Passive/Active Devices, Kirchoff’s Laws, Ohm’s Law, Power, Magnetism.</li>
                <li>**Elementary Theory of Alternating Currents:** Sinusoidal quantities (RMS, peak), Phase, Reactance, Impedance, Resonance, Rectifiers.</li>
                <li>**Elementary Theory of Semiconductor Devices:** Diodes, Transistors (amplifiers, oscillators, detectors).</li>
                <li>**Radio Receivers:** T.R.F. and Superheterodyne, CW reception, Receiver characteristics (Sensitivity, Selectivity, AVC).</li>
                <li>**Transmitter:** Low power transmitter principles, Crystal oscillators, Semiconductor based transmitters.</li>
                <li>**Radio Wave Propagation:** Electromagnetic Spectrum, Wavelength, Ground/Sky/Space waves, Skip distance, Fading.</li>
                <li>**Aerials:** Common transmitting and receiving types.</li>
                <li>**Frequency Measurement:** Simple frequency meters.</li>
            </ul>

            <p class="mt-4 font-medium text-gray-200">Section B: Radio Regulations</p>
            <ul class="list-disc list-inside ml-4 text-sm space-y-1 text-gray-300">
                <li>Indian Wireless Telegraph Rules (1973) and Amateur Service Rules (1978).</li>
                <li>ITU Radio Regulations (Designation of Emission, Phonetic alphabets, Frequencies, Interference, Distress/Urgency Signals, Call Signs, Amateur Station Article 25).</li>
                <li>Standard Frequency and Time Signals.</li>
                <li>**'Q' codes and Abbreviations:** (QRA through QUM, AA through WB).</li>
            </ul>
            <p class="text-sm text-yellow-400 mt-3">
                **Pass Criteria:** Max Marks 100. Must secure **40%** in each section and **50%** in aggregate. **NO Morse test** for Restricted grade.
            </p>
        </div>

        <div class="mt-6 p-4 border border-gray-600 rounded-lg">
            <h4 class="text-2xl font-bold text-amber-300 border-b pb-2 mb-3">General Examination</h4>
            
            <p class="font-semibold text-white">Part I – Written Test (2 Hours)</p>
            
            <p class="mt-2 font-medium text-gray-200">Section A: Radio Theory and Practice (Restricted Syllabus + Additions)</p>
            <ul class="list-disc list-inside ml-4 text-sm space-y-1 text-gray-300">
                <li>**Principles of Communications:** Analog/Digital, Modulation (AM, FM, Pulse), Demodulation.</li>
                <li>**Alternating Current:** Transformers (construction, losses, matching).</li>
                <li>**Semi Conductor devices and Transistors:** Conduction, Biasing.</li>
                <li>**Power Supplies:** Half/Full wave, Bridge rectifier, Smoothing/Regulating circuits.</li>
                <li>**Transmitters and Receivers:** Elementary principles of Facsimile and Television signals.</li>
                <li>**Propagation:** Ionosphere/Troposphere characteristics, Critical frequency.</li>
                <li>**Aerials:** Principles of radiation, aerials for different frequency bands (including microwave).</li>
                <li>**Space Communications:** Elementary principles of communication via satellites.</li>
            </ul>

            <p class="mt-4 font-medium text-gray-200">Section B: Radio Regulations</p>
            <p class="text-sm text-gray-300">Same syllabus as prescribed for the Restricted examination.</p>
            <p class="text-sm text-yellow-400 mt-3">
                **Pass Criteria:** Max Marks 100. Must secure **50%** in each section and **60%** in aggregate.
            </p>

            <p class="font-semibold text-white mt-4">Part II – Morse (8 wpm)</p>
            <ul class="list-disc list-inside ml-4 text-sm space-y-1 text-gray-300">
                <li>**Reception:** 5-minute test of a 200-character plain language passage (letters, figures, and common punctuation) at **8 wpm**. More than 5 errors is a fail.</li>
                <li>**Sending:** 5-minute test sending a similar passage at a speed **not less than 8 wpm**.</li>
                <li>Candidate must pass **both** receiving and sending simultaneously.</li>
            </ul>
        </div>
    </div>
</section>
<div id="content-morse" class="content-section hidden">
    <div class="card p-6 rounded-xl">
        <h2 class="text-2xl font-semibold mb-4 text-white">Morse Code Group Quiz</h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 items-end">
            <div>
                <label for="morse-length" class="block text-sm font-medium text-gray-400 mb-1">Group Length</label>
                <select id="morse-length" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 text-white focus:ring-blue-500 focus:border-blue-500">
                    <option value="1">1 Character</option>
                    <option value="2">2 Characters (Double)</option>
                    <option value="3">3 Characters (Triple)</option>
                    <option value="4">4 Characters</option>
                </select>
            </div>
            <div>
                <label for="morse-mode" class="block text-sm font-medium text-gray-400 mb-1">Quiz Mode</label>
                <select id="morse-mode" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 text-white focus:ring-blue-500 focus:border-blue-500">
                    <option value="receive">Receive (Sound -> Type)</option>
                    <option value="send">Send (Type -> Keyer Tap)</option>
                </select>
            </div>
            <div class="flex items-end">
                <button id="start-morse-quiz-button" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                    Start Morse Quiz!
                </button>
            </div>
        </div>

        <div id="morse-quiz-area" class="mt-6 text-center card p-6">
            <p class="text-center text-gray-400 mb-4" id="morse-message">Select length and mode, then click 'Start Morse Quiz!'</p>
            
            <div id="morse-quiz-container" class="hidden">
                
                <div class="mb-6">
                    <p class="text-lg text-gray-400" id="morse-quiz-counter">0/10</p>
                    <p id="morse-quiz-status" class="text-lg font-medium text-blue-400 mb-4"></p>
                </div>

                <div id="receive-mode-controls" class="hidden">
                    <div class="bg-gray-800 p-6 rounded-xl mb-4">
                        <p class="text-xl font-bold text-secondary mb-4">Listen carefully...</p>
                        <button id="play-morse-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg transition duration-150">
                            <svg class="w-6 h-6 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1V8a1 1 0 011-1h1.586l4.137-4.137A2 2 0 0111 3.536v16.928a2 2 0 01-.277 1.137l-4.137-4.137z"></path></svg>
                            Play Morse
                        </button>
                    </div>

                    <label for="morse-input-text" class="block text-sm font-medium text-gray-400 mb-2">Your Answer:</label>
                    <input type="text" id="morse-input-text" maxlength="4" class="w-full max-w-sm mx-auto p-3 text-2xl text-center rounded-lg bg-gray-800 border border-gray-600 text-white uppercase focus:ring-blue-500 focus:border-blue-500" disabled>
                    <button id="submit-morse-button" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150">
                        Submit
                    </button>
                    <p id="morse-receive-feedback" class="mt-4 text-xl font-bold"></p>
                </div>
                
                <div id="send-mode-controls" class="hidden">
                    <div class="bg-gray-800 p-6 rounded-xl mb-4">
                        <p class="text-sm font-medium text-gray-400 mb-2">Send the following with the Keyer:</p>
                        <p id="target-send-text" class="text-5xl font-extrabold text-secondary tracking-widest"></p>
                    </div>
                    
                    <div class="flex flex-col items-center">
                        <button id="send-keyer-button" class="w-full max-w-xs h-32 bg-primary text-4xl font-extrabold text-white rounded-xl mb-4 active:bg-red-700" data-keyer-state="up">
                            KEY
                        </button>
                        <p class="text-gray-400 text-sm mb-4">Spacebar is also enabled for sending.</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 text-center mt-4">
                        <div class="bg-gray-900 p-3 rounded-lg">
                            <h4 class="text-sm font-medium text-gray-400">Your Morse Input</h4>
                            <p id="morse-send-input-display" class="text-xl font-mono text-yellow-400 truncate overflow-x-auto h-8 flex items-center justify-center">_</p>
                        </div>
                        <div class="bg-gray-900 p-3 rounded-lg">
                            <h4 class="text-sm font-medium text-gray-400">Decoded</h4>
                            <p id="morse-send-decoded-output" class="text-xl font-mono text-green-400 truncate overflow-x-auto h-8 flex items-center justify-center">_</p>
                        </div>
                    </div>
                    <p id="morse-send-feedback" class="mt-4 text-xl font-bold"></p>

                    <button id="send-next-button" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 hidden">
                        Next
                    </button>
                </div>
                
                <button id="end-morse-quiz-button" class="mt-6 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 hidden">
                    End Quiz
                </button>
            </div>

            <div id="morse-quiz-results" class="hidden text-center card p-8 mt-6">
                <h3 class="text-3xl font-bold mb-4 text-gray-100">Morse Quiz Complete!</h3>
                <div id="morse-result-message" class="text-2xl font-semibold mb-4 text-green-400"></div>
                <p class="text-gray-300 mb-6">You got <span id="morse-final-score" class="font-bold text-blue-400"></span> out of <span id="morse-final-total" class="font-bold text-blue-400"></span> correct.</p>
                <button onclick="resetMorseQuizSetup();" class="bg-purple-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-purple-700 transition">
                    Start a New Morse Quiz
                </button>
            </div>

        </div>
    </div>
</div>


        <footer class="text-center mt-12 pt-6 border-t border-gray-700 text-gray-500 text-sm">
            <p>&copy; 2024 Ham Radio Prep Guide (India General & Restricted)</p>
            <p>Built with <span class="text-red-500">❤️</span> for the ASOC Aspirant.</p>
        </footer>

    </div>

    <script>
        // Use an immediately invoked function expression (IIFE) to contain variables
        (function() {

            // ===============================================
            // 0. DATA STRUCTURES (Syllabus, Quiz Questions)
            // ===============================================

            // 1. Morse Code Mapping
            const MORSE_MAP = {
                'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.', 'G': '--.', 'H': '....', 'I': '..', 'J': '.---',
                'K': '-.-', 'L': '.-..', 'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.', 'S': '...', 'T': '-',
                'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-', 'Y': '-.--', 'Z': '--..',
                '1': '.----', '2': '..---', '3': '...--', '4': '....-', '5': '.....',
                '6': '-....', '7': '--...', '8': '---..', '9': '----.', '0': '-----',
                '.': '.-.-.-', ',': '--..--', '?': '..--..', '/': '-..-.',
                ' ': ' ' // Space separates words
            };

            // Reverse map for quick decoding
            const REVERSE_MORSE = Object.keys(MORSE_MAP).reduce((acc, key) => {
                acc[MORSE_MAP[key]] = key;
                return acc;
            }, {});

            // ... (rest of data structures: RULES_CONTENT, ELECTRONICS_CONTENT, QUIZ_QUESTIONS)
            // ... (omitted for brevity, assume they are present)
            const RULES_CONTENT = [
                { title: "Licensing Requirements (1978 Rules)", content: ` <p>To obtain an amateur license in India, you must:</p> <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300"> <li>A citizen of India.</li> <li>At least 18 years of age. (Relaxed to 14 for General, 12 for Restricted).</li> <li>Have passed the Amateur Station Operators' Examination (ASOC) for the required grade.</li> </ul> ` }, { title: "Amateur Station Regulations (ITU Art. 25)", content: ` <p>An amateur station (Art. 25) is for personal, non-commercial use only. You are <b>strictly forbidden</b> to transmit:</p> <ul class="list-disc list-inside mt-2 space-y-2 ml-4 text-red-300"> <li>Music, broadcast programmes, or any entertainment.</li> <li>Advertisements or any communications for business (no "pecuniary interest").</li> <li>False or misleading signals (like a fake "MAYDAY"). (Art. 19)</li> <li>Messages for or on behalf of third parties (with one major exception...).</li> <li>Any matter which is indecent, obscene, or offensive.</li> <li>Statements on political or industrial controversy.</li> </ul> ` }, { title: "Emergency & Third-Party Messages (1978 Rules)", content: ` <p>The rule against transmitting for third parties has one crucial exception: <b>EMERGENCIES!</b></p> <p class="mt-2">In the event of a failure of normal communication systems (per the 1978 rules), you are <b>PERMITTED</b> to handle third-party messages related to:</p> <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-green-300"> <li>Natural calamities like earthquakes, floods, or cyclones.</li> <li>War or national emergency.</li> <li>Accidents involving ships, aircraft, or vehicles.</li> </ul> ` }, { title: "Interference & Operating Practices (ITU Art. 19)", content: ` <p>You must not cause **harmful interference** which is defined as "seriously degrade, obstruct, or repeatedly interrupt" any other radio service.</p> <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300"> <li><b>Listen First:</b> Always listen to ensure the frequency is clear before transmission.</li> <li><b>Stop if Causing Harm:</b> If you are told you are causing interference, you must stop or restrict transmissions immediately.</li> <li><b>Tests:</b> Keep tests (like calling "VVV" or a short carrier) as short as possible. Use a dummy load for longer, internal equipment tests.</li> </ul> ` }, { title: "Nomenclature of Frequency & Wavelength (ITU Art. 2)", content: ` <p>Article 2 defines the naming conventions for the radio spectrum bands:</p> <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300"> <li><b>VLF</b> (Very Low Frequency): 3 - 30 kHz</li> <li><b>LF</b> (Low Frequency): 30 - 300 kHz</li> <li><b>MF</b> (Medium Frequency): 300 - 3000 kHz</li> <li><b>HF</b> (High Frequency): <b>3 - 30 MHz</b> (The primary long-distance band)</li> <li><b>VHF</b> (Very High Frequency): <b>30 - 300 MHz</b> (Includes 2m band)</li> <li><b>UHF</b> (Ultra High Frequency): <b>300 - 3000 MHz</b> (Includes 70cm band)</li> </ul> ` }, { title: "Frequency Allocation for Amateur Services (ITU Art. 5)", content: ` <p>Article 5 is the global frequency allocation master table. For General Grade Indian amateurs, the key allocated bands are:</p> <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300"> <li><b>HF Bands:</b> 160m, 80m, 40m, 30m, 20m, 17m, 15m, 12m, 10m (Primary long-distance bands)</li> <li><b>VHF Bands:</b> 6m, 2m (Local/line-of-sight)</li> <li><b>UHF Bands:</b> 70cm (Local/line-of-sight)</li> </ul> ` }, { title: "Call Signs & Identification (ITU Art. 19 & App. 42)", content: ` <p>Your call sign is your international ID (Art. 19). You must transmit it at the start, end, and at least every 10 minutes during transmission.</p> <p class="mt-2"><b>Indian Call Signs (Appendix 42):</b> The ITU allocates blocks of call signs. India is allocated:</p> <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300"> <li><b>ATA - AWZ</b></li> <li><b>VTA - VWZ</b> (The VU block comes from this)</li> <li><b>8TA - 8YZ</b></li> </ul> ` }, { title: "Standard Frequency and Time Signals Services", content: ` <p>These services provide synchronized time and a stable frequency reference across the world (e.g., for setting your radio's clock).</p> <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300"> <li><b>WWV</b> & <b>WWVH:</b> Operated by the USA (NIST).</li> <li><b>CHU:</b> Operated by Canada.</li> <li><b>ATA:</b> Operated by **India** (National Physical Laboratory, New Delhi).</li> </ul> ` }, { title: "Q-Codes: The Full List (Syllabus)", content: ` <p>Here are the Q-Codes you are required to know for the exam. They are a fast way to exchange common information.</p> <div class="simple-list mt-3"> <div class="simple-list-item"><b>QRA:</b> What is the name of your station?</div> <div class="simple-list-item"><b>QRG:</b> What is my exact frequency?</div> <div class="simple-list-item"><b>QRH:</b> Does my frequency vary?</div> <div class="simple-list-item"><b>QRI:</b> How is my tone? (1-3)</div> <div class="simple-list-item"><b>QRK:</b> What is my readability? (1-5)</div> <div class="simple-list-item"><b>QRL:</b> Are you busy? (I am busy)</div> <div class="simple-list-item"><b>QRM:</b> Are you being interfered with? (Man-made)</div> <div class="simple-list-item"><b>QRN:</b> Are you troubled by static? (Natural)</div> <div class="simple-list-item"><b>QRO:</b> Shall I increase power?</div> <div class="simple-list-item"><b>QRS:</b> Shall I send more slowly?</div> <div class="simple-list-item"><b>QRT:</b> Shall I stop sending?</div> <div class="simple-list-item"><b>QRU:</b> Have you anything for me?</div> <div class="simple-list-item"><b>QRV:</b> Are you ready?</div> <div class="simple-list-item"><b>QRW:</b> Shall I inform... who... that you are calling him?</div> <div class="simple-list-item"><b>QRX:</b> When will you call me again?</div> <div class="simple-list-item"><b>QRZ:</b> Who is calling me?</div> <div class="simple-list-item"><b>QSA:</b> What is my signal strength? (1-5)</div> <div class="simple-list-item"><b>QSB:</b> Is my signal fading?</div> <div class="simple-list-item"><b>QSD:</b> Is my keying defective?</div> <div class="simple-list-item"><b>QSG:</b> Shall I send... messages at a time?</div> <div class="simple-list-item"><b>QSL:</b> Can you acknowledge receipt?</div> <div class="simple-list-item"><b>QSM:</b> Shall I repeat the last message?</div> <div class="simple-list-item"><b>QSO:</b> Can you communicate with... directly?</div> <div class="simple-list-item"><b>QSP:</b> Will you relay to...?</div> <div class="simple-list-item"><b>QSR:</b> Shall I repeat the call of the last station?</div> <div class="simple-list-item"><b>QST:</b> General call preceding a message concerning all stations.</div> <div class="simple-list-item"><b>QSU:</b> Shall I send or reply on this frequency?</div> <div class="simple-list-item"><b>QSV:</b> Shall I send a series of V's?</div> <div class="simple-list-item"><b>QSW:</b> Will you transmit on this frequency?</div> <div class="simple-list-item"><b>QSX:</b> Will you listen to... on... kHz/MHz?</div> <div class="simple-list-item"><b>QSY:</b> Shall I change to transmit on another frequency?</div> <div class="simple-list-item"><b>QTB:</b> Do you agree with my counting of words?</div> <div class="simple-list-item"><b>QTC:</b> How many messages to send?</div> <div class="simple-list-item"><b>QTH:</b> What is your location?</div> <div class="simple-list-item"><b>QTR:</b> What is the correct time?</div> <div class="simple-list-item"><b>QUM:</b> Is the distress traffic over?</div> </div> ` }, { title: "Common Abbreviations (CW & Voice)", content: ` <p>These abbreviations are used to speed up conversations, especially in Morse Code (CW).</p> <div class="simple-list mt-3"> <div class="simple-list-item"><b>AA:</b> All after</div> <div class="simple-list-item"><b>AB:</b> All before</div> <div class="simple-list-item"><b>AR:</b> End of message (End of transmission)</div> <div class="simple-list-item"><b>AS:</b> Wait / Stand by</div> <div class="simple-list-item"><b>C:</b> Yes / Correct</div> <div class="simple-list-item"><b>CFM:</b> Confirm</div> <div class="simple-list-item"><b>CL:</b> Closing down station</div> <div class="simple-list-item"><b>CQ:</b> Calling any station</div> <div class="simple-list-item"><b>DE:</b> From (e.g., "VU2XYZ DE VU3ABC")</div> <div class="simple-list-item"><b>K:</b> Go ahead and transmit (Over)</div> <div class="simple-list-item"><b>NIL:</b> Nothing</div> <div class="simple-list-item"><b>OK:</b> Correct / Agreed</div> <div class="simple-list-item"><b>R:</b> Received (Roger)</div> <div class="simple-list-item"><b>TU:</b> Thank You</div> <div class="simple-list-item"><b>VA:</b> End of work (Signing off - SK)</div> <div class="simple-list-item"><b>WA:</b> Word after</div> <div class="simple-list-item"><b>WB:</b> Word before</div> </div> ` }, { title: "The Phonetic Alphabet (ITU Appendix 14)", content: ` <p>To avoid confusion, especially in noisy conditions, we use the International Phonetic Alphabet (Appendix 14). This is mandatory knowledge!</p> <div class="phonetic-table mt-4"> <div class="phonetic-item"><div class="phonetic-letter">A</div><div class="phonetic-word">Alfa</div></div> <div class="phonetic-item"><div class="phonetic-letter">B</div><div class="phonetic-word">Bravo</div></div> <div class="phonetic-item"><div class="phonetic-letter">C</div><div class="phonetic-word">Charlie</div></div> <div class="phonetic-item"><div class="phonetic-letter">D</div><div class="phonetic-word">Delta</div></div> <div class="phonetic-item"><div class="phonetic-letter">E</div><div class="phonetic-word">Echo</div></div> <div class="phonetic-item"><div class="phonetic-letter">F</div><div class="phonetic-word">Foxtrot</div></div> <div class="phonetic-item"><div class="phonetic-letter">G</div><div class="phonetic-word">Golf</div></div> <div class="phonetic-item"><div class="phonetic-letter">H</div><div class="phonetic-word">Hotel</div></div> <div class="phonetic-item"><div class="phonetic-letter">I</div><div class="phonetic-word">India</div></div> <div class="phonetic-item"><div class="phonetic-letter">J</div><div class="phonetic-word">Juliett</div></div> <div class="phonetic-item"><div class="phonetic-letter">K</div><div class="phonetic-word">Kilo</div></div> <div class="phonetic-item"><div class="phonetic-letter">L</div><div class="phonetic-word">Lima</div></div> <div class="phonetic-item"><div class="phonetic-letter">M</div><div class="phonetic-word">Mike</div></div> <div class="phonetic-item"><div class="phonetic-letter">N</div><div class="phonetic-word">November</div></div> <div class="phonetic-item"><div class="phonetic-letter">O</div><div class="phonetic-word">Oscar</div></div> <div class="phonetic-item"><div class="phonetic-letter">P</div><div class="phonetic-word">Papa</div></div> <div class="phonetic-item"><div class="phonetic-letter">Q</div><div class="phonetic-word">Quebec</div></div> <div class="phonetic-item"><div class="phonetic-letter">R</div><div class="phonetic-word">Romeo</div></div> <div class="phonetic-item"><div class="phonetic-letter">S</div><div class="phonetic-word">Sierra</div></div> <div class="phonetic-item"><div class="phonetic-letter">T</div><div class="phonetic-word">Tango</div></div> <div class="phonetic-item"><div class="phonetic-letter">U</div><div class="phonetic-word">Uniform</div></div> <div class="phonetic-item"><div class="phonetic-letter">V</div><div class="phonetic-word">Victor</div></div> <div class="phonetic-item"><div class="phonetic-letter">W</div><div class="phonetic-word">Whiskey</div></div> <div class="phonetic-item"><div class="phonetic-letter">X</div><div class="phonetic-word">X-ray</div></div> <div class="phonetic-item"><div class="phonetic-letter">Y</div><div class="phonetic-word">Yankee</div></div> <div class="phonetic-item"><div class="phonetic-letter">Z</div><div class="phonetic-word">Zulu</div></div> </div> ` }, ];
            const ELECTRONICS_CONTENT = [
                { title: "CHAPTER 1: ELECTRICITY AND MAGNETISM", content: ` <h4 class="font-semibold">1. Basic Quantities & Ohm's Law Analogy</h4> <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300"> <li>**Voltage (E or V):** Like **Water Pressure**. The force that pushes current. Measured in **Volts** (V).</li> <li>**Current (I):** Like **Water Flow**. The rate of charge movement. Measured in **Amperes** (Amps).</li> <li>**Resistance (R):** Like the **Pipe Narrowness**. How much the material opposes flow. Measured in **Ohms** ($$\\Omega$$).</li> </ul> <p class="mt-2 font-semibold">If you increase the pressure (V), the flow (I) increases, assuming the pipe (R) stays the same.</p> ` }, { title: "Capacitors and Inductors (Energy Storage)", content: ` <h4 class="font-semibold text-lg mt-3">Capacitors: The Temporary Battery</h4> <p>A capacitor stores energy in an **electric field** between two plates. It **blocks DC** current but **passes AC** current. Think of it as a tiny, temporary battery that smooths out voltage spikes.</p> <p class="mt-2 text-sm text-gray-400">Unit: Farad (F). Reactance (opposition to AC) is inversely proportional to frequency.</p> <h4 class="font-semibold text-lg mt-3">Inductors: The Magnetic Flywheel</h4> <p>An inductor (coil of wire) stores energy in a **magnetic field**. It **passes DC** current but **opposes changes in AC** current (reactance increases with frequency). It resists sudden changes in current.</p> <p class="mt-2 text-sm text-gray-400">Unit: Henry (H). Used in filters and resonant circuits.</p> ` }, { title: "Resonance in RLC Circuits (The Tuning Sweet Spot)", content: ` <p>A **Resonant Circuit** is an RLC circuit (Resistor, Inductor, Capacitor) where the **capacitive reactance ($$X_C$$)** and the **inductive reactance ($$X_L$$)** are equal, causing them to cancel each other out. This occurs at a single frequency, the **resonant frequency ($$f_r$$)**.</p> <p class="mt-2 font-semibold">This is how radio receivers select a specific station. The circuit offers very low impedance (in series) or very high impedance (in parallel) at the resonant frequency.</p> ` }, { title: "CHAPTER 2: ELEMENTARY THEORY OF ALTERNATING CURRENTS", content: ` <h4 class="font-semibold">1. What is Alternating Current (AC)?</h4> <p class="text-gray-300">Current that periodically reverses direction. Key terms: Frequency (Hertz), Cycle, Period, Peak Value, RMS (Root Mean Square) value (RMS = Peak / 1.414).</p> <h4 class="font-semibold mt-2">2. Transformers</h4> <p class="text-gray-300">Uses changing magnetic fields to step up or step down AC voltage. It **does not work with DC**. The voltage ratio is equal to the turns ratio: $$V_p / V_s = N_p / N_s$$.</p> ` }, { title: "CHAPTER 3: SEMICONDUCTORS & TRANSISTORS", content: ` <h4 class="font-semibold">1. Diodes (The One-Way Gate)</h4> <p class="text-gray-300">Allows current flow in only one direction (forward biased). Used mainly for **Rectification** (converting AC to pulsating DC) and **Detection** (separating audio from RF).</p> <h4 class="font-semibold mt-2">2. Rectifiers & Power Supplies</h4> <p class="text-gray-300">**Half-wave:** Uses one diode (pulsating DC, inefficient). **Full-wave/Bridge:** Uses two or four diodes (smoother DC, more efficient). **Filter/Smoothing:** Capacitors and inductors are used to smooth the pulsating DC into steady DC.</p> <h4 class="font-semibold mt-2">3. Bipolar Junction Transistors (BJTs)</h4> <p class="text-gray-300">Transistors (Emitter-Base-Collector) amplify or switch. Small base current controls large collector current.</p> ` }, { title: "CHAPTER 4: RADIO RECEIVERS", content: ` <h4 class="font-semibold">1. Fundamentals of Radio Reception</h4> <p class="text-gray-300">A receiver captures radio waves, selects frequency, amplifies, demodulates and outputs audio.</p> <h4 class="font-semibold mt-2">2. Tuning and Selectivity</h4> <p class="text-gray-300">Tuning adjusts resonant L-C circuits; selectivity is ability to reject nearby signals; sensitivity is ability to amplify weak signals.</p> <h4 class="font-semibold mt-2">3. Modulation Techniques</h4> <p class="text-gray-300">AM, SSB (J3E), FM, PM and digital modes like PSK/QAM.</p> ` }, { title: "CHAPTER 5: RADIO TRANSMITTERS", content: ` <h4 class="font-semibold">1. Key Transmitter Stages (Block Diagram)</h4> <p class="text-gray-300">Microphone -> Audio Amplifier -> Modulator -> **RF Oscillator (Generates Carrier)** -> **RF Power Amplifier** -> Antenna Matching -> Antenna.</p> <h4 class="font-semibold mt-2">2. Oscillators</h4> <p class="text-gray-300">Circuit that generates a continuous, stable AC signal (the carrier wave). A crystal oscillator is used for high frequency stability.</p> ` }, { title: "CHAPTER 6: PROPAGATION & ANTENNAS", content: ` <h4 class="font-semibold">1. Propagation Modes</h4> <ul class="list-disc list-inside mt-2 space-y-1 ml-4 text-gray-300"> <li>**Ground Wave:** Follows the curvature of the earth (used at MF/LF for medium distances).</li> <li>**Sky Wave:** Refracted by the **Ionosphere** (D, E, F layers). Used for long-distance **HF** communication (DX). The **F-layer** is most responsible.</li> <li>**Space Wave:** Line-of-sight (LOS). Used for **VHF/UHF**.</li> </ul> <h4 class="font-semibold mt-2">2. Antennas</h4> <p class="text-gray-300">Converts electrical energy to radio waves. Types: Dipole (basic), Yagi (directional), Vertical (omni-directional).</p> ` }, ];

            const QUIZ_QUESTIONS = [
                // Part A: Rules & Procedures (12 questions)
                { category: 'rules', question: "What Q-code means 'What is my exact frequency?'", options: ["QRG", "QSY", "QRX", "QSO"], answer: "QRG", explanation: "QRG is the Q-code for 'What is my exact frequency?'" }, { category: 'rules', question: "What Q-code is used to ask 'Does my frequency vary?'", options: ["QRH", "QRG", "QSU", "QSW"], answer: "QRH", explanation: "QRH is the Q-code for 'Does my frequency vary?'" }, { category: 'rules', question: "What Q-code is used to ask 'How is my tone? (1-3)'", options: ["QRK", "QRI", "QSA", "QSB"], answer: "QRI", explanation: "QRI is the Q-code for 'How is my tone? (1-3)'" }, { category: 'rules', question: "What Q-code means 'I am busy' or 'Are you busy?'", options: ["QRL", "QRU", "QRT", "QSY"], answer: "QRL", explanation: "QRL is the Q-code for 'Are you busy? / I am busy.'" }, { category: 'rules', question: "What Q-code means 'Are you troubled by static?' (Natural Interference)", options: ["QRM", "QRN", "QRS", "QTH"], answer: "QRN", explanation: "QRN stands for natural static/noise." }, { category: 'rules', question: "What Q-code means 'Are you being interfered with?' (Man-made Interference)", options: ["QRM", "QRN", "QRO", "QRT"], answer: "QRM", explanation: "QRM stands for man-made interference." }, { category: 'rules', question: "The abbreviation 'DE' is used to mean:", options: ["Yes / Correct", "From", "Wait", "End of message"], answer: "From", explanation: "DE means 'from' (e.g., CQ DE VU2ABC)." }, { category: 'rules', question: "The abbreviation 'AR' is used to mean:", options: ["Wait", "All after", "End of message (End of transmission)", "Go ahead"], answer: "End of message (End of transmission)", explanation: "AR is a prosign used to mark the end of a message." }, { category: 'rules', question: "The abbreviation 'K' is used to mean:", options: ["Thank You", "Nothing", "Received", "Go ahead and transmit (Over)"], answer: "Go ahead and transmit (Over)", explanation: "K is the invitation to transmit." }, { category: 'rules', question: "Which of the following is strictly forbidden for Amateur stations?", options: ["Emergency messages", "Transmitting in Morse Code", "Commercial advertising", "Contesting"], answer: "Commercial advertising", explanation: "Amateur stations are strictly prohibited from transmitting any communications for business or pecuniary interest." }, { category: 'rules', question: "What is the phonetic word for the letter 'Q'?", options: ["Quebec", "Queen", "Quincy", "Quiet"], answer: "Quebec", explanation: "The correct ITU phonetic word for 'Q' is Quebec." }, { category: 'rules', question: "Which frequency band is defined by 3 MHz to 30 MHz?", options: ["VHF", "UHF", "HF", "MF"], answer: "HF", explanation: "HF (High Frequency) covers 3 MHz to 30 MHz." },
                // Part B: Basic Electronics (12 questions)
                { category: 'electronics', chapter:1, question:"In the analogy for Ohm's law, Current (I) is compared to:", options:["Water Flow", "Water Pressure", "Pipe Narrowness", "Water Pump"], answer:"Water Flow", explanation:"Current is the flow (Amperes); Voltage is the pressure (Volts); Resistance is the opposition (Ohms)."}, {category:'electronics', chapter:1, question:"A capacitor is primarily used to store energy in a(n):", options:["Magnetic Field", "Electric Field", "Chemical Reaction", "Thermal Sink"], answer:"Electric Field", explanation:"Capacitors store energy in an electric field between two plates."}, {category:'electronics', chapter:1, question:"In a series RLC circuit, resonance occurs when:", options:["Capacitive Reactance is zero", "Inductive Reactance is zero", "Capacitive Reactance equals Inductive Reactance", "Resistance equals Inductance"], answer:"Capacitive Reactance equals Inductive Reactance", explanation:"Resonance is defined as the point where $$X_L = X_C$$. This is the tuning sweet spot."}, {category:'electronics', chapter:2, question:"What is the primary function of a transformer?", options:["Convert AC to DC", "Convert DC to AC", "Step up or step down AC voltage", "Generate a carrier wave"], answer:"Step up or step down AC voltage", explanation:"Transformers use alternating magnetic fields to change AC voltage levels."}, {category:'electronics', chapter:3, question:"A diode is commonly used in power supplies for:", options:["Amplification", "Modulation", "Rectification", "Oscillation"], answer:"Rectification", explanation:"Diodes allow current in one direction, converting AC to pulsating DC (Rectification)."}, {category:'electronics', chapter:3, question:"What component is typically used in a power supply to smooth out pulsating DC?", options:["Diode", "Transistor", "Capacitor", "Antenna"], answer:"Capacitor", explanation:"A capacitor (filter/smoothing) stores charge to smooth out the ripples after rectification."}, {category:'electronics', chapter:4, question:"In a radio receiver, the ability to reject signals on frequencies close to the desired frequency is called:", options:["Sensitivity", "Selectivity", "Modulation", "Demodulation"], answer:"Selectivity", explanation:"Selectivity is the ability to select the desired signal and reject adjacent ones."}, {category:'electronics', chapter:5, question:"The component in a transmitter that generates the stable, high-frequency carrier signal is the:", options:["Audio Amplifier", "RF Power Amplifier", "Oscillator", "Modulator"], answer:"Oscillator", explanation:"Oscillator generates the RF carrier."}, {category:'electronics', chapter:5, question:"What component increases the power level of a modulated RF signal before transmission?", options:["Antenna","RF Power Amplifier","Oscillator","Mixer"], answer:"RF Power Amplifier", explanation:"The RF power amplifier boosts signal power for transmission."}, {category:'electronics', chapter:5, question:"Modulation is the process of:" , options:["Converting DC to AC","Adding information onto a carrier","Measuring frequency","Tuning an antenna"], answer:"Adding information onto a carrier", explanation:"Modulation imposes info on the carrier (AM/FM/SSB)."}, {category:'electronics', chapter:6, question:"Which propagation mode is mainly responsible for long-distance HF communication?", options:["Space wave","Ground wave","Sky wave (ionospheric)","Surface wave"], answer:"Sky wave (ionospheric)", explanation:"Sky wave refracted by ionosphere enables long-distance HF contacts."}, {category:'electronics', chapter:6, question:"Line-of-sight VHF/UHF signals primarily use which propagation?", options:["Sky wave","Space wave","Ground wave","Ionospheric"], answer:"Space wave", explanation:"VHF/UHF are mainly line-of-sight (space wave)."},
                // Part C: Prosigns & Phonetics (10 questions)
                { category: 'prosigns', question: "What is the phonetic word for the letter 'S'?", options: ["Sugar", "Sierra", "Seattle", "Seven"], answer: "Sierra", explanation: "The correct ITU phonetic word for 'S' is Sierra." }, { category: 'prosigns', question: "What is the phonetic word for the letter 'X'?", options: ["Xylophone", "Xavier", "X-ray", "Extra"], answer: "X-ray", explanation: "The correct ITU phonetic word for 'X' is X-ray." }, { category: 'prosigns', question: "What is the phonetic word for the letter 'H'?", options: ["Hotel", "Hawaii", "Holiday", "Hello"], answer: "Hotel", explanation: "The correct ITU phonetic word for 'H' is Hotel." }, { category: 'prosigns', question: "What is the phonetic word for the letter 'C'?", options: ["Call", "Cable", "Charlie", "Cobra"], answer: "Charlie", explanation: "The correct ITU phonetic word for 'C' is Charlie." }, { category: 'prosigns', question: "What does the abbreviation 'R' mean in CW/voice?", options: ["Repeat", "Received (Roger)", "Ready", "Report"], answer: "Received (Roger)", explanation: "'R' is shorthand for 'Received' or 'Roger' (message received)." }, { category: 'prosigns', question: "What does the abbreviation 'TU' mean in CW/voice?", options: ["Tune Up", "Transmit Under", "Thank You", "Too Loud"], answer: "Thank You", explanation: "'TU' is the common abbreviation for 'Thank You'." }, { category: 'prosigns', question: "The prosign 'VA' or 'SK' is used to mean:", options: ["Go ahead and transmit", "Calling any station", "End of work (Signing off)", "Nothing"], answer: "End of work (Signing off)", explanation: "VA/SK means 'End of work' or 'Signing off'." }, { category: 'prosigns', question: "What does the Q-code QSY mean?", options: ["What is my signal strength?", "Shall I change to transmit on another frequency?", "Is the distress traffic over?", "Are you ready?"], answer: "Shall I change to transmit on another frequency?", explanation: "QSY means 'Shall I change to transmit on another frequency?' or 'I am changing frequency.'" }, { category: 'prosigns', question: "What does the Q-code QTR mean?", options: ["What is your location?", "What is the correct time?", "How is my tone?", "Is my signal fading?"], answer: "What is the correct time?", explanation: "QTR means 'What is the correct time?'" }, { category: 'prosigns', question: "What does the Q-code QSA mean?", options: ["What is my signal strength? (1-5)", "Is my keying defective?", "Shall I repeat the last message?", "Is my frequency varying?"], answer: "What is my signal strength? (1-5)", explanation: "QSA means 'What is my signal strength?'" },
            ];
            // ===============================================
            // 1. GLOBAL STATE & ELEMENTS
            // ===============================================
            
            // Audio context for all sound generation
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            let receptionOscillator;
            let receptionGainNode;
            let currentToneReject = null; // Promise reject function for current tone playback
            let toneTimeout = null;
            let isPaused = false;
            let currentSequenceIndex = 0;
            
            // 3. Timing Constants (These are for the keyer/TX practice)

            let currentWordWPM = 20; // Default WPM for Keyer/TX
            let DOT_MS, DASH_MS, ELEM_BREAK_MS, CHAR_BREAK_MS, WORD_BREAK_MS;

            /**
             * Recalculates all timing constants based on the provided WPM.
             * Uses the standard Paris formula: Dot duration = 60000ms / (50 units * WPM)
             */
            function updateKeyerTimingConstants(wpm) {
                // 1. Calculate the core Dot duration
                DOT_MS = 60000 / (50 * wpm); 
                
                // 2. Define standard Morse timing ratios
                DASH_MS = DOT_MS * 3;
                ELEM_BREAK_MS = DOT_MS; // Time between dot/dash in a character
                CHAR_BREAK_MS = DOT_MS * 3; // Time between characters
                WORD_BREAK_MS = DOT_MS * 7; // Time between words
                
                // 3. Update the global variable
                currentWordWPM = wpm;
            }

            // Keyer State
            let keyerDownTime = 0;
            let currentMorseSequence = '';
            let decodedMessage = '';
            let keyerTimeout;
            let longWordTimeout;

            // ===============================================
            // 2. KEYER (TRANSMISSION PRACTICE) LOGIC
            // ===============================================

            /**
             * The fix for the Z issue is applied here by resetting 
             * currentMorseSequence unconditionally after the timeout.
             */
            function decodeCurrentSequence() {
                let char = REVERSE_MORSE[currentMorseSequence] || '';
                
                if (char) {
                    decodedMessage += char;
                    els.decodedOutput.textContent = decodedMessage;

                    // If in Morse Quiz send mode, check against target
                    if (quizState.active && quizState.mode === 'send') {
                        checkSendAnswer(char);
                    }

                }
                
                // THE FIX: Reset the sequence after the character break timeout 
                // This prevents the next element from concatenating with a failed partial sequence.
                currentMorseSequence = '';
                
                els.inputMorseDisplay.textContent = currentMorseSequence || '_';
                els.morseSendInputDisplay.textContent = currentMorseSequence || '_';
                els.morseSendDecodedOutput.textContent = decodedMessage.slice(-quizState.groupLength) || '_';
            }

            function decodeWordBreak() {
                // If the user pauses for a long word break, it means they completed the word, 
                // but only clear the word break if a character was actually decoded previously.
                if (decodedMessage.slice(-1) !== ' ') {
                    decodedMessage += ' ';
                    els.decodedOutput.textContent = decodedMessage;
                }
                els.inputMorseDisplay.textContent = '_';
                els.morseSendInputDisplay.textContent = '_';
                // Note: The send quiz doesn't use word breaks, only character breaks, so we don't clear the decoded output here
            }

            function handleKeyDown(event) {
                // Ignore key down if keyer is already down (to prevent repeat events)
                if (keyerDownTime > 0) return;
                
                // Clear the character break timeout if it exists
                if (keyerTimeout) {
                    clearTimeout(keyerTimeout);
                    keyerTimeout = null;
                }
                // Clear the word break timeout if it exists
                if (longWordTimeout) {
                    clearTimeout(longWordTimeout);
                    longWordTimeout = null;
                }

                keyerDownTime = Date.now();
                
                // Visual change for mouse click
                if (event.type === 'mousedown' || event.type === 'touchstart') {
                    els.keyerButton.style.backgroundColor = '#fcd34d'; // Amber
                    els.sendKeyerButton.style.backgroundColor = '#fcd34d'; // Amber
                }
                
                // Start tone
                startTone(600); // 600Hz tone for keyer
            }

            function handleKeyUp() {
                if (keyerDownTime === 0) return; // Ignore if keyer wasn't down
                
                const duration = Date.now() - keyerDownTime;
                
                // Stop tone
                stopTone();
                
                // Reset visual change
                els.keyerButton.style.backgroundColor = 'var(--primary)'; // Blue
                els.sendKeyerButton.style.backgroundColor = 'var(--primary)'; // Blue
                
                let element;
                
                // Determine if it was a DOT or a DASH
                if (duration >= DASH_MS) {
                    element = '-'; // Dash
                } else if (duration >= DOT_MS) {
                    element = '.'; // Dot
                } else {
                    // Ignore very short taps (noise)
                    keyerDownTime = 0;
                    return;
                }

                // Add to current sequence and update display
                currentMorseSequence += element;
                els.inputMorseDisplay.textContent = currentMorseSequence;
                els.morseSendInputDisplay.textContent = currentMorseSequence;
                
                // Reset down time
                keyerDownTime = 0;

                // Start character break timer
                // After CHAR_BREAK_MS, it assumes the character is complete.
                keyerTimeout = setTimeout(decodeCurrentSequence, CHAR_BREAK_MS);

                // Start word break timer
                // After WORD_BREAK_MS, it inserts a space (if applicable)
                longWordTimeout = setTimeout(decodeWordBreak, WORD_BREAK_MS);

            }
            
            // ... (rest of keyer-related functions)
            function startTone(frequency) {
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                if (receptionOscillator) {
                    stopTone(); // Stop any existing tone
                }

                // Create oscillator and gain node
                receptionOscillator = audioContext.createOscillator();
                receptionGainNode = audioContext.createGain();

                // Set frequency and connect nodes
                receptionOscillator.frequency.setValueAtTime(frequency, audioContext.currentTime); // 600Hz
                receptionOscillator.connect(receptionGainNode);
                receptionGainNode.connect(audioContext.destination);

                // Start with volume 0 to ramp up
                receptionGainNode.gain.setValueAtTime(0, audioContext.currentTime);

                // Ramp volume up quickly (attack)
                const attackTime = 0.01;
                receptionGainNode.gain.linearRampToValueAtTime(0.5, audioContext.currentTime + attackTime);
                
                receptionOscillator.start();
            }

            function stopTone() {
                 if (receptionOscillator) {
                    const decayTime = 0.05;
                    const stopTime = audioContext.currentTime + decayTime;
                    // Ramp volume down quickly (decay)
                    receptionGainNode.gain.linearRampToValueAtTime(0, stopTime);
                    // Stop the oscillator after decay
                    receptionOscillator.stop(stopTime);
                    receptionOscillator = null;
                    receptionGainNode = null;
                }
            }
            
            function clearKeyerInput() {
                currentMorseSequence = '';
                decodedMessage = '';
                els.inputMorseDisplay.textContent = '_';
                els.decodedOutput.textContent = '_';

                // Also clear the quiz send inputs
                els.morseSendInputDisplay.textContent = '_';
                els.morseSendDecodedOutput.textContent = '_';
                els.targetSendText.textContent = '';
                
                if (keyerTimeout) clearTimeout(keyerTimeout);
                if (longWordTimeout) clearTimeout(longWordTimeout);
                keyerTimeout = null;
                longWordTimeout = null;
                keyerDownTime = 0;
                
                stopTone();
            }


            // ... (rest of functions: startTone, stopTone, etc.)

            // ===============================================
            // 3. RECEPTION (TEXT TO TONE) LOGIC
            // ===============================================
            
            // WPM for reception practice (independent from keyer WPM)
            const WPM_RANGE_MIN = 4;
            const WPM_RANGE_MAX = 40;
            const WPM_DEFAULT = 10;
            let RECEPTION_WPM = WPM_DEFAULT;
            let RECEPTION_DOT_MS = 60000 / (50 * RECEPTION_WPM);
            
            function updateReceptionTiming(wpm) {
                 RECEPTION_WPM = wpm;
                 RECEPTION_DOT_MS = 60000 / (50 * RECEPTION_WPM);
            }

            function sleep(ms) {
                // Clears the reject function if sleep is successful (not interrupted)
                return new Promise((resolve, reject) => {
                    if (isPaused) {
                        currentToneReject = reject;
                        return; // Wait for resume
                    }
                    if (currentToneReject) currentToneReject = null;

                    toneTimeout = setTimeout(resolve, ms);
                    currentToneReject = reject; // Set reject function in case of stop/pause
                }).finally(() => {
                    // Clear the timeout and reject function if the sleep ends normally or is rejected
                    if (toneTimeout) clearTimeout(toneTimeout);
                    toneTimeout = null;
                    currentToneReject = null;
                });
            }


            /**
             * Plays a single dot or dash tone.
             * @param {string} element - '.' for dot, '-' for dash
             * @param {number} elementDuration - duration of the element (Dot_MS or Dash_MS)
             */
            function playElement(element, elementDuration) {
                return new Promise(async (resolve, reject) => {
                    if (isPaused) {
                        currentToneReject = reject;
                        return;
                    }
                    if (currentToneReject) currentToneReject = null;

                    try {
                        // Start Tone
                        startTone(600); // Consistent 600Hz
                        
                        // Keep track of the promise reject function for global stop/pause handling
                        currentToneReject = reject;

                        // Tone duration
                        await sleep(elementDuration);

                        // Stop Tone
                        stopTone();

                        // Element break (space between elements within a character)
                        if (element !== ' ') {
                             await sleep(RECEPTION_DOT_MS);
                        }

                        resolve();

                    } catch (e) {
                        // This catches the rejection from `sleep` if playback is stopped/paused
                        if (e === 'Playback stopped' || e === 'Playback paused') {
                            reject(e);
                        } else {
                            console.error("Error during tone playback:", e);
                            reject(e);
                        }
                    }
                });
            }

            /**
             * Converts and plays a text sequence as Morse code.
             * @param {string} text - The text to be converted to Morse.
             */
            async function playSequence(text) {
                // Clean up any previous state
                resetTone(); 
                currentSequenceIndex = 0;
                isPaused = false;
                
                // UI updates
                els.playMorseButton.textContent = 'Pause';
                els.stopMorseButton.disabled = false;
                els.playMorseButton.classList.add('bg-orange-500', 'hover:bg-orange-600');
                els.playMorseButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');

                // Generate Morse sequence
                const fullText = text.toUpperCase();
                let morseSequence = '';
                let dotMS = RECEPTION_DOT_MS;
                let dashMS = dotMS * 3;
                let charBreakMS = dotMS * 3;
                let wordBreakMS = dotMS * 7;
                let errorOccurred = false;

                try {
                    for (const char of fullText) {
                        if (isPaused) throw 'Playback paused';
                        if (errorOccurred) break; 
                        
                        const morse = MORSE_MAP[char];

                        if (morse === undefined) {
                            console.warn(`Character '${char}' not supported.`);
                            continue;
                        }
                        
                        // Display the current character being played
                        els.currentCharacter.textContent = char;

                        if (morse === ' ') {
                            // Word break (Space)
                            morseSequence += ' / ';
                            els.morseSequenceOutput.textContent = morseSequence;
                            await sleep(wordBreakMS - charBreakMS); // Already had a char break, so subtract it.
                            continue;
                        }

                        // Play all elements of the character
                        for (const element of morse) {
                            if (isPaused) throw 'Playback paused';
                            
                            // Display the Morse code element
                            els.morseSequenceOutput.textContent = morseSequence + element;

                            if (element === '.') {
                                morseSequence += element;
                                await playElement(element, dotMS);
                            } else if (element === '-') {
                                morseSequence += element;
                                await playElement(element, dashMS);
                            }
                        }

                        morseSequence += ' '; // Add space between characters in the sequence display
                        
                        // Character break (space between characters)
                        await sleep(charBreakMS);
                        
                        // Stop tone after the last character break
                        stopTone();
                        
                    }
                } catch (e) {
                    if (e === 'Playback paused') {
                        // User paused, do nothing but keep UI state consistent
                    } else if (e === 'Playback stopped') {
                        errorOccurred = true;
                    } else {
                        console.error("Sequence playback error:", e);
                        errorOccurred = true;
                    }
                } finally {
                    // Cleanup and reset UI after sequence is complete or stopped/errored
                    if (!isPaused && !errorOccurred) {
                        els.morseSequenceOutput.textContent = morseSequence.trim();
                        els.currentCharacter.textContent = 'DONE';
                    }
                    
                    if (!isPaused) {
                        // Final UI reset if not paused
                        els.playMorseButton.textContent = 'Play';
                        els.stopMorseButton.disabled = true;
                        els.playMorseButton.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                        els.playMorseButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        els.currentCharacter.textContent = '';
                    } else if (isPaused) {
                        // If paused, update button to Resume
                        els.playMorseButton.textContent = 'Resume';
                    }
                }
            }
            
            // ... (rest of reception-related functions: resetTone, handlePlayPauseStop, etc.)
            /**
             * Stops the tone and resets the audio context/timeouts.
             * @param {boolean} isPausing - True if the action is a pause (which prevents clearing the playback promise).
             */
            function resetTone(isPausing = false) {
                const stopTime = audioContext ? audioContext.currentTime : 0;
                if (receptionOscillator) {
                    try {
                        receptionOscillator.stop(stopTime);
                        receptionOscillator.disconnect();
                    } catch (e) { console.error("Oscillator stop error:", e); }
                }
                if (receptionGainNode) {
                    try {
                        receptionGainNode.gain.cancelScheduledValues(stopTime);
                        receptionGainNode.gain.setValueAtTime(0, stopTime);
                        receptionGainNode.disconnect();
                    } catch (e) { console.error("Gain stop error:", e); }
                }
                if (toneTimeout) {
                    clearTimeout(toneTimeout);
                    toneTimeout = null;
                }
                
                // If it's a stop (not a pause), reject the promise chain to break the loop
                if (!isPausing && currentToneReject) {
                    currentToneReject('Playback stopped');
                }
            }


            function handlePlayPauseStop(action) {
                const text = els.inputText.value;
                const sequence = text.toUpperCase().split('').map(c => MORSE_MAP[c]).join('').trim();
                
                if (action === 'play' || action === 'resume') {
                    if (isPaused) {
                        isPaused = false;
                        // Re-trigger the logic that was rejected during the pause
                        if (currentToneReject) {
                            currentToneReject('Playback resumed'); // Resolve the promise that was rejected on pause
                            currentToneReject = null; // Clear it after resolving
                            // The playSequence loop will resume automatically because isPaused is false
                        }
                    } else if (sequence && !receptionOscillator) {
                        // Start playing only if there's text and nothing is currently playing
                        // This assumes the core logic for the Quiz also uses playSequence or similar promises
                        playSequence(text);
                    }
                } else if (action === 'pause') {
                    isPaused = true;
                    resetTone(true); // Reset tone but don't reject the promise chain
                    els.playMorseButton.textContent = 'Resume';
                    els.playMorseButton.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                    els.playMorseButton.classList.add('bg-green-500', 'hover:bg-green-600');
                } else if (action === 'stop') {
                    isPaused = false;
                    resetTone();
                    
                    // UI Reset
                    els.playMorseButton.textContent = 'Play';
                    els.stopMorseButton.disabled = true;
                    els.morseSequenceOutput.textContent = '_';
                    els.currentCharacter.textContent = '';
                    
                    els.playMorseButton.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                    els.playMorseButton.classList.remove('bg-green-500', 'hover:bg-green-600');
                    els.playMorseButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }
            }


            // ===============================================
            // 4. GENERAL QUIZ LOGIC
            // ===============================================

            // ... (quizState, shuffleArray, getRandomQuestions, startQuiz, etc. - omitted for brevity)
            let quizState = {
                questions: [],
                currentQuestionIndex: 0,
                score: 0,
                active: false,
                // Morse Quiz specific
                isMorseQuizActive: false,
                mode: 'receive', // 'receive' or 'send'
                groupLength: 1,
                targetSequence: '',
                currentSequence: '',
                currentInput: '',
                scoreHistory: []
            };

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function getRandomQuestions(category, count) {
                let availableQuestions = [];
                if (category === 'mixed') {
                    availableQuestions = QUIZ_QUESTIONS;
                } else if (category === 'prosigns') {
                    availableQuestions = QUIZ_QUESTIONS.filter(q => q.category === 'prosigns');
                } else {
                    availableQuestions = QUIZ_QUESTIONS.filter(q => q.category === category || q.category === 'prosigns');
                }
                
                const shuffled = shuffleArray([...availableQuestions]);
                return shuffled.slice(0, count);
            }

            function startQuiz() {
                const category = els.quizCategory.value;
                const count = parseInt(els.quizCount.value);
                
                quizState.questions = getRandomQuestions(category, count);
                quizState.currentQuestionIndex = 0;
                quizState.score = 0;
                quizState.active = true;
                
                els.quizSetup.classList.add('hidden');
                els.quizActive.classList.remove('hidden');
                els.quizResults.classList.add('hidden');
                
                loadQuestion();
            }

            function loadQuestion() {
                if (quizState.currentQuestionIndex >= quizState.questions.length) {
                    return showResults();
                }
                
                const currentQ = quizState.questions[quizState.currentQuestionIndex];
                
                els.questionNumber.textContent = `Question ${quizState.currentQuestionIndex + 1} of ${quizState.questions.length}`;
                els.questionText.textContent = currentQ.question;
                
                els.optionsContainer.innerHTML = '';
                els.feedbackCard.classList.add('hidden');
                els.submitBtn.textContent = 'Submit Answer';
                els.submitBtn.disabled = true;
                
                const shuffledOptions = shuffleArray([...currentQ.options]);
                
                shuffledOptions.forEach(option => {
                    const optionId = `option-${option.replace(/\s/g, '-')}`;
                    const label = document.createElement('label');
                    label.htmlFor = optionId;
                    label.className = 'block p-3 rounded-lg bg-gray-700 hover:bg-gray-600 cursor-pointer transition';
                    label.innerHTML = `<input type="radio" id="${optionId}" name="quiz-option" value="${option}" class="mr-3 text-blue-500 focus:ring-blue-500" onclick="document.getElementById('submit-btn').disabled = false;"> ${option}`;
                    els.optionsContainer.appendChild(label);
                });
            }

            function submitAnswer() {
                const currentQ = quizState.questions[quizState.currentQuestionIndex];
                const selectedOption = document.querySelector('input[name="quiz-option"]:checked');
                
                if (!selectedOption) return; // Should be disabled if nothing is selected, but safety check
                
                const isCorrect = selectedOption.value === currentQ.answer;
                
                // Disable all options and change colors based on correctness
                document.querySelectorAll('input[name="quiz-option"]').forEach(input => {
                    const label = input.closest('label');
                    input.disabled = true;
                    if (input.value === currentQ.answer) {
                        // Highlight correct answer
                        label.classList.add('bg-green-700', 'border-2', 'border-green-400');
                        label.classList.remove('hover:bg-gray-600');
                    } else if (input.checked) {
                        // Highlight wrong selection
                        label.classList.add('bg-red-700', 'border-2', 'border-red-400');
                        label.classList.remove('hover:bg-gray-600');
                    } else {
                        // Dim unselected wrong options
                        label.classList.add('opacity-50', 'bg-gray-800');
                        label.classList.remove('hover:bg-gray-700');
                    }
                });
                
                if (isCorrect) {
                    quizState.score++;
                    document.getElementById('current-score').textContent = quizState.score;
                    document.getElementById('feedback-title').textContent = "✅ Correct!";
                    document.getElementById('feedback-explanation').textContent = currentQ.explanation;
                    els.feedbackCard.classList.remove('hidden');
                    els.feedbackCard.classList.remove('bg-red-900', 'border-red-400', 'text-red-300');
                    els.feedbackCard.classList.add('bg-green-900', 'border-green-400', 'text-green-300');
                } else {
                    document.getElementById('feedback-title').textContent = "❌ Incorrect. Here's the concept:";
                    document.getElementById('feedback-explanation').textContent = currentQ.explanation;
                    els.feedbackCard.classList.remove('hidden');
                    els.feedbackCard.classList.add('bg-red-900', 'border-red-400', 'text-red-300');
                }
                
                // Change button to Next and set up for next question
                els.submitBtn.textContent = 'Next Question';
                els.submitBtn.onclick = () => {
                    quizState.currentQuestionIndex++;
                    loadQuestion();
                };
                els.submitBtn.disabled = false;
                
                // Update progress display
                document.getElementById('current-progress').textContent = quizState.currentQuestionIndex + 1;
            }

            function showResults() {
                const total = quizState.questions.length;
                const score = quizState.score;
                const percentage = (score / total) * 100;
                let message = '';
                
                if (percentage >= 80) {
                    message = "Excellent work! You're ready to tackle the exam!";
                } else if (percentage >= 60) {
                    message = "Good attempt! Review the concepts in your weaker areas for a guaranteed pass.";
                } else {
                    message = "Keep studying! Focus on the concepts to improve your score.";
                }
                
                document.getElementById('result-message').textContent = message;
                document.getElementById('final-score').textContent = score;
                document.getElementById('final-total').textContent = total;
                
                els.quizActive.classList.add('hidden');
                els.quizResults.classList.remove('hidden');
                quizState.active = false;
            }

            function resetQuizSetup() {
                els.quizSetup.classList.remove('hidden');
                els.quizActive.classList.add('hidden');
                els.quizResults.classList.add('hidden');
                document.getElementById('current-score').textContent = '0';
                document.getElementById('total-questions').textContent = '0';
                document.getElementById('current-progress').textContent = '0';
                document.getElementById('total-progress').textContent = '0';
            }


            // ===============================================
            // 5. MORSE QUIZ LOGIC
            // ===============================================

            // ... (morse quiz related functions - omitted for brevity)
            function getRandomMorseCharacters(length) {
                const chars = Object.keys(MORSE_MAP).filter(k => k.match(/[A-Z0-9]/));
                let sequence = '';
                for (let i = 0; i < length; i++) {
                    sequence += chars[Math.floor(Math.random() * chars.length)];
                }
                return sequence;
            }

            function startMorseQuiz() {
                const mode = els.morseMode.value;
                const length = parseInt(els.morseLength.value);

                quizState.isMorseQuizActive = true;
                quizState.mode = mode;
                quizState.groupLength = length;
                quizState.currentQuestionIndex = 0;
                quizState.score = 0;
                quizState.scoreHistory = [];

                els.morseQuizArea.querySelector('.grid').classList.add('hidden');
                els.morseQuizContainer.classList.remove('hidden');
                els.endMorseQuizButton.classList.remove('hidden');
                els.morseMessage.classList.add('hidden');
                els.morseQuizResults.classList.add('hidden');
                
                // Reset keyer state
                clearKeyerInput();

                if (mode === 'receive') {
                    els.receiveModeControls.classList.remove('hidden');
                    els.sendModeControls.classList.add('hidden');
                    els.morseInputText.disabled = true;
                } else {
                    els.receiveModeControls.classList.add('hidden');
                    els.sendModeControls.classList.remove('hidden');
                    // Reset decoded message for sending
                    decodedMessage = '';
                    els.morseSendDecodedOutput.textContent = '_';
                }

                loadMorseQuestion();
            }

            function loadMorseQuestion() {
                if (quizState.currentQuestionIndex >= 10) { // Hardcoded 10 questions for Morse Quiz
                    return endQuiz();
                }

                quizState.currentQuestionIndex++;
                
                const targetText = getRandomMorseCharacters(quizState.groupLength);
                quizState.targetSequence = targetText.toUpperCase().split('').map(c => MORSE_MAP[c]).join(' / ');
                quizState.currentSequence = targetText;
                
                els.morseQuizCounter.textContent = `${quizState.currentQuestionIndex}/10`;
                els.morseQuizStatus.textContent = quizState.mode === 'receive' ? 'Group ready for reception.' : 'Send the following:';
                
                // Reset mode-specific UI
                if (quizState.mode === 'receive') {
                    els.morseInputText.value = '';
                    els.morseInputText.disabled = false;
                    els.submitMorseButton.disabled = false;
                    els.playMorseButton.disabled = false;
                    els.morseReceiveFeedback.textContent = '';
                } else {
                    // Send mode
                    els.targetSendText.textContent = targetText;
                    decodedMessage = ''; // Clear decoded message for a fresh start on send mode
                    els.morseSendDecodedOutput.textContent = '_';
                    els.morseSendFeedback.textContent = '';
                    els.sendNextButton.classList.add('hidden');
                }
            }

            // ===============================================
            // 5a. MORSE RECEIVE LOGIC
            // ===============================================
            
            // ... (receive logic - omitted for brevity)
            function submitReceiveAnswer() {
                const answer = els.morseInputText.value.toUpperCase();
                const target = quizState.currentSequence;
                const isCorrect = answer === target;
                
                els.morseInputText.disabled = true;
                els.submitMorseButton.disabled = true;
                els.playMorseButton.disabled = true;

                if (isCorrect) {
                    quizState.score++;
                    els.morseReceiveFeedback.textContent = '✅ Correct!';
                    els.morseReceiveFeedback.classList.remove('text-red-400');
                    els.morseReceiveFeedback.classList.add('text-green-400');
                } else {
                    els.morseReceiveFeedback.textContent = `❌ Wrong. Correct: ${target} (${quizState.targetSequence})`;
                    els.morseReceiveFeedback.classList.remove('text-green-400');
                    els.morseReceiveFeedback.classList.add('text-red-400');
                }
                
                quizState.scoreHistory.push({ target: target, input: answer, correct: isCorrect });
                
                setTimeout(loadMorseQuestion, 2000);
            }

            // ===============================================
            // 5b. MORSE SEND LOGIC
            // ===============================================
            
            // ... (send logic - omitted for brevity)
            function checkSendAnswer(decodedChar) {
                const target = quizState.currentSequence;
                const currentInput = decodedMessage.replace(/\s/g, ''); // Current decoded string without spaces
                
                els.morseSendInputDisplay.textContent = currentMorseSequence; // Still showing the current one being keyed
                els.morseSendDecodedOutput.textContent = decodedMessage.slice(-quizState.groupLength).trim() || '_';

                // Check for completion
                if (currentInput.length === target.length) {
                    const isCorrect = currentInput === target;

                    // Disable keyer and timeouts
                    keyerDownTime = -1; // Flag to ignore key up
                    if (keyerTimeout) clearTimeout(keyerTimeout);
                    if (longWordTimeout) clearTimeout(longWordTimeout);
                    stopTone(); // Ensure tone is off

                    if (isCorrect) {
                        quizState.score++;
                        els.morseSendFeedback.textContent = '✅ Correct Sequence!';
                        els.morseSendFeedback.classList.remove('text-red-400');
                        els.morseSendFeedback.classList.add('text-green-400');
                    } else {
                        els.morseSendFeedback.textContent = `❌ Wrong Sequence. Target: ${target}`;
                        els.morseSendFeedback.classList.remove('text-green-400');
                        els.morseSendFeedback.classList.add('text-red-400');
                    }

                    quizState.scoreHistory.push({ target: target, input: currentInput, correct: isCorrect });
                    
                    els.sendNextButton.classList.remove('hidden');
                    els.sendNextButton.onclick = loadMorseQuestion;
                    // Reset keyer down time flag for next question
                    keyerDownTime = 0;

                } else if (currentInput.length > target.length) {
                    // User over-keyed, fail the question immediately
                    keyerDownTime = -1;
                    if (keyerTimeout) clearTimeout(keyerTimeout);
                    if (longWordTimeout) clearTimeout(longWordTimeout);
                    stopTone();
                    
                    els.morseSendFeedback.textContent = `❌ Over-keyed. Target: ${target}`;
                    els.morseSendFeedback.classList.remove('text-green-400');
                    els.morseSendFeedback.classList.add('text-red-400');

                    quizState.scoreHistory.push({ target: target, input: currentInput, correct: false });
                    els.sendNextButton.classList.remove('hidden');
                    els.sendNextButton.onclick = loadMorseQuestion;
                    keyerDownTime = 0;
                }
            }


            function endQuiz() {
                resetTone();
                quizState.isMorseQuizActive = false;
                
                const total = 10;
                const score = quizState.score;
                const percentage = (score / total) * 100;
                let message = '';
                
                if (percentage >= 80) {
                    message = "Excellent work! Your Morse is sharp!";
                } else if (percentage >= 60) {
                    message = "Good job! A little more practice and you'll be solid.";
                } else {
                    message = "Keep practicing! Focus on consistency.";
                }

                // UI updates
                els.morseResultMessage.textContent = message;
                els.morseFinalScore.textContent = score;
                els.morseFinalTotal.textContent = total;

                els.morseQuizContainer.classList.add('hidden');
                els.endMorseQuizButton.classList.add('hidden');
                els.morseQuizResults.classList.remove('hidden');
            }

            function resetMorseQuizSetup() {
                els.morseQuizArea.querySelector('.grid').classList.remove('hidden');
                els.morseQuizResults.classList.add('hidden');
                els.morseMessage.classList.remove('hidden');
                els.receiveModeControls.classList.add('hidden');
                els.sendModeControls.classList.add('hidden');
                
                // Final clean up
                clearKeyerInput();
            }


            // ===============================================
            // 6. INITIALIZATION & UTILITIES
            // ===============================================

            const els = {
                // Navigation/View
                tabButtons: document.querySelectorAll('.tab-button'),
                contentSections: document.querySelectorAll('.content-section'),
                
                // Morse Code Chart
                morseChart: document.getElementById('morse-chart'),

                // Transmission Practice (Keyer)
                keyerButton: document.getElementById('keyerButton'),
                inputMorseDisplay: document.getElementById('inputMorseDisplay'),
                decodedOutput: document.getElementById('decodedOutput'),
                clearKeyerButton: document.getElementById('clearKeyerButton'),
                wordSpeedSlider: document.getElementById('wordSpeedSlider'), // NEW
                wordSpeedValue: document.getElementById('wordSpeedValue'),   // NEW

                // Reception Practice (Text to Tone)
                wpmRange: document.getElementById('wpmRange'),
                wpmValue: document.getElementById('wpmValue'),
                inputText: document.getElementById('inputText'),
                playMorseButton: document.getElementById('playMorseButton'),
                stopMorseButton: document.getElementById('stopMorseButton'),
                morseSequenceOutput: document.getElementById('morseSequenceOutput'),
                currentCharacter: document.getElementById('currentCharacter'),
                
                // Study Content
                rulesContent: document.getElementById('rules-content'),
                electronicsContent: document.getElementById('electronics-content'),
                
                // General Quiz Elements
                quizSetup: document.getElementById('quiz-setup'),
                quizCategory: document.getElementById('quiz-category'),
                quizCount: document.getElementById('quiz-count'),
                quizActive: document.getElementById('quiz-active'),
                questionNumber: document.getElementById('question-number'),
                questionText: document.getElementById('question-text'),
                optionsContainer: document.getElementById('options-container'),
                submitBtn: document.getElementById('submit-btn'),
                feedbackCard: document.getElementById('feedback-card'),
                quizResults: document.getElementById('quiz-results'),

                // Morse Quiz Elements
                morseQuizArea: document.getElementById('morse-quiz-area'),
                morseLength: document.getElementById('morse-length'),
                morseMode: document.getElementById('morse-mode'),
                startMorseQuizButton: document.getElementById('start-morse-quiz-button'),
                morseQuizContainer: document.getElementById('morse-quiz-container'),
                morseQuizCounter: document.getElementById('morse-quiz-counter'),
                morseQuizStatus: document.getElementById('morse-quiz-status'),
                receiveModeControls: document.getElementById('receive-mode-controls'),
                sendModeControls: document.getElementById('send-mode-controls'),
                playMorseButtonQuiz: document.getElementById('play-morse-button'),
                morseInputText: document.getElementById('morse-input-text'),
                submitMorseButton: document.getElementById('submit-morse-button'),
                morseReceiveFeedback: document.getElementById('morse-receive-feedback'),
                targetSendText: document.getElementById('target-send-text'),
                sendKeyerButton: document.getElementById('send-keyer-button'),
                morseSendInputDisplay: document.getElementById('morse-send-input-display'),
                morseSendDecodedOutput: document.getElementById('morse-send-decoded-output'),
                morseSendFeedback: document.getElementById('morse-send-feedback'),
                sendNextButton: document.getElementById('send-next-button'),
                endMorseQuizButton: document.getElementById('end-morse-quiz-button'),
                morseQuizResults: document.getElementById('morse-quiz-results'),
                morseResultMessage: document.getElementById('morse-result-message'),
                morseFinalScore: document.getElementById('morse-final-score'),
                morseFinalTotal: document.getElementById('morse-final-total'),
                morseMessage: document.getElementById('morse-message')
            };

            // Main function to control tab display
            window.showSection = function(sectionId) {
                els.contentSections.forEach(section => {
                    section.classList.add('hidden');
                });
                document.getElementById(sectionId).classList.remove('hidden');

                els.tabButtons.forEach(button => {
                    if (button.textContent.toLowerCase().replace(/\s/g, '') === sectionId) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });

                // Specific action for quiz section
                if (sectionId === 'quiz') {
                    resetQuizSetup();
                }
            }


            /**
             * Dynamically generates the content for the Rules and Electronics sections.
             */
            function renderStudyContent() {
                const rulesContainer = document.getElementById('rules-content');
                rulesContainer.innerHTML = RULES_CONTENT.map(item => `
                    <div class="card p-5">
                        <h3 class="text-2xl font-bold text-gray-100 mb-3 border-b border-gray-600 pb-1">${item.title}</h3>
                        <div class="text-gray-300">${item.content}</div>
                    </div>
                `).join('');

                const electronicsContainer = document.getElementById('electronics-content');
                electronicsContainer.innerHTML = ELECTRONICS_CONTENT.map(item => `
                    <div class="card p-5">
                        <h3 class="text-2xl font-bold text-gray-100 mb-3 border-b border-gray-600 pb-1">${item.title}</h3>
                        <div class="text-gray-300">${item.content}</div>
                    </div>
                `).join('');

                // Render Morse Chart
                let morseChartHTML = '<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">';
                const chartKeys = Object.keys(MORSE_MAP).filter(k => k.length === 1 && k !== ' ');
                for (const key of chartKeys) {
                    morseChartHTML += `
                        <div class="bg-gray-800 p-3 rounded-lg flex justify-between items-center">
                            <span class="text-3xl font-bold text-amber-300">${key}</span>
                            <span class="text-2xl dot-dash">${MORSE_MAP[key]}</span>
                        </div>
                    `;
                }
                morseChartHTML += '</div>';
                els.morseChart.innerHTML = morseChartHTML;
            }


            // ===============================================
            // 7. EVENT LISTENERS & INITIALIZATION
            // ===============================================
            
            // Initialization
            document.addEventListener('DOMContentLoaded', () => {
                renderStudyContent();
                // Ensure the morse practice tab is active on load
                showSection('morsepractice');
                
                // Initialize timing constants with the default WPM for keyer
                updateKeyerTimingConstants(currentWordWPM);
                // Initialize timing constants for reception
                updateReceptionTiming(parseInt(els.wpmRange.value));

                // Initialize the quiz progress display
                document.getElementById('total-questions').textContent = quizState.questions.length;
                document.getElementById('total-progress').textContent = quizState.questions.length;

                // Bind click to start general quiz
                window.startQuiz = startQuiz;
                window.submitAnswer = submitAnswer;
                window.resetQuizSetup = resetQuizSetup;
            });
            
            // Keyer Clear button
            els.clearKeyerButton.addEventListener('click', clearKeyerInput);

            // Keyer WPM Slider Listener (for Transmission Practice)
            els.wordSpeedSlider.addEventListener('input', (e) => {
                const newWPM = parseInt(e.target.value, 10);
                
                // 1. Update the displayed WPM value
                els.wordSpeedValue.textContent = newWPM;
                
                // 2. Recalculate all keyer timing constants
                updateKeyerTimingConstants(newWPM);
            });
            

            // Reception WPM Slider
            els.wpmRange.addEventListener('input', (e) => {
                const newWPM = parseInt(e.target.value, 10);
                els.wpmValue.textContent = newWPM;
                updateReceptionTiming(newWPM);
            });
            
            // Reception Play/Pause/Stop
            els.playMorseButton.addEventListener('click', () => {
                // Determine if it's play or resume based on current state
                const action = isPaused ? 'resume' : 'play';
                handlePlayPauseStop(action);
            });
            
            els.stopMorseButton.addEventListener('click', () => handlePlayPauseStop('stop'));
            
            // Morse Quiz setup button
            els.startMorseQuizButton.addEventListener('click', startMorseQuiz);
            
            // Morse Quiz RX button
            els.playMorseButtonQuiz.addEventListener('click', () => playSequence(quizState.currentSequence));
            els.submitMorseButton.addEventListener('click', submitReceiveAnswer);
            els.morseInputText.addEventListener('keyup', (e) => { if(e.key === 'Enter') submitReceiveAnswer(); });


            // Keyer Listeners (Mouse/Touch)
            els.keyerButton.addEventListener('mousedown', handleKeyDown);
            els.keyerButton.addEventListener('touchstart', (e) => { e.preventDefault(); handleKeyDown(e); });
            window.addEventListener('mouseup', handleKeyUp);
            window.addEventListener('touchend', handleKeyUp);
            
            // Keyer Listeners (Spacebar) - Main Keyer
            window.addEventListener('keydown', (e) => {
                if(e.code === 'Space' && !quizState.isMorseQuizActive) {
                    e.preventDefault();
                    handleKeyDown(e);
                }
            });
            window.addEventListener('keyup', (e) => {
                if(e.code === 'Space' && !quizState.isMorseQuizActive) {
                    handleKeyUp();
                }
            });

            // Keyer Listeners (Spacebar) - Quiz Send Mode
            els.sendKeyerButton.addEventListener('mousedown', handleKeyDown);
            els.sendKeyerButton.addEventListener('touchstart', (e) => { e.preventDefault(); handleKeyDown(e); });
            window.addEventListener('mouseup', handleKeyUp);
            window.addEventListener('touchend', handleKeyUp);
            
            window.addEventListener('keydown', (e) => {
                if(e.code === 'Space' && quizState.isMorseQuizActive && quizState.mode === 'send') {
                    e.preventDefault();
                    handleKeyDown(e);
                }
            });
            window.addEventListener('keyup', (e) => {
                if(e.code === 'Space' && quizState.isMorseQuizActive && quizState.mode === 'send') {
                    handleKeyUp();
                }
            });


            els.endMorseQuizButton.addEventListener('click', endQuiz);
            
            // Initial call to ensure the keyer is set up with default WPM
            updateKeyerTimingConstants(currentWordWPM);

        })();
    </script>
</body>
</html>
```
